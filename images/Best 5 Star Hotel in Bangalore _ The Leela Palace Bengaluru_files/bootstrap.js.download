(()=>{var xo=Object.create;var he=Object.defineProperty,wo=Object.defineProperties,Xr=Object.getOwnPropertyDescriptor,So=Object.getOwnPropertyDescriptors,ko=Object.getOwnPropertyNames,en=Object.getOwnPropertySymbols,Ao=Object.getPrototypeOf,tn=Object.prototype.hasOwnProperty,Oo=Object.prototype.propertyIsEnumerable,rn=Math.pow,nn=(t,e,r)=>e in t?he(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,A=(t,e)=>{for(var r in e||(e={}))tn.call(e,r)&&nn(t,r,e[r]);if(en)for(var r of en(e))Oo.call(e,r)&&nn(t,r,e[r]);return t},G=(t,e)=>wo(t,So(e)),Co=t=>he(t,"__esModule",{value:!0});var on=(t=>typeof require!="undefined"?require:typeof Proxy!="undefined"?new Proxy(t,{get:(e,r)=>(typeof require!="undefined"?require:e)[r]}):t)(function(t){if(typeof require!="undefined")return require.apply(this,arguments);throw new Error('Dynamic require of "'+t+'" is not supported')});var V=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports);var To=(t,e,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of ko(e))!tn.call(t,n)&&n!=="default"&&he(t,n,{get:()=>e[n],enumerable:!(r=Xr(e,n))||r.enumerable});return t},R=t=>To(Co(he(t!=null?xo(Ao(t)):{},"default",t&&t.__esModule&&"default"in t?{get:()=>t.default,enumerable:!0}:{value:t,enumerable:!0})),t),C=(t,e,r,n)=>{for(var i=n>1?void 0:n?Xr(e,r):e,s=t.length-1,a;s>=0;s--)(a=t[s])&&(i=(n?a(e,r,i):a(i))||i);return n&&i&&he(e,r,i),i};var u=(t,e,r)=>new Promise((n,i)=>{var s=d=>{try{c(r.next(d))}catch(f){i(f)}},a=d=>{try{c(r.throw(d))}catch(f){i(f)}},c=d=>d.done?n(d.value):Promise.resolve(d.value).then(s,a);c((r=r.apply(t,e)).next())});var ze=V((nc,Ke)=>{var sn,an,cn,ln,dn,un,pn,fn,mn,Fe,Ht,gn,yn,de,hn,bn,vn,xn,wn,Sn,kn,An,We;(function(t){var e=typeof global=="object"?global:typeof self=="object"?self:typeof this=="object"?this:{};typeof define=="function"&&undefined?define("tslib",["exports"],function(n){t(r(e,r(n)))}):typeof Ke=="object"&&typeof Ke.exports=="object"?t(r(e,r(Ke.exports))):t(r(e));function r(n,i){return n!==e&&(typeof Object.create=="function"?Object.defineProperty(n,"__esModule",{value:!0}):n.__esModule=!0),function(s,a){return n[s]=i?i(s,a):a}}})(function(t){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(n[s]=i[s])};sn=function(n,i){e(n,i);function s(){this.constructor=n}n.prototype=i===null?Object.create(i):(s.prototype=i.prototype,new s)},an=Object.assign||function(n){for(var i,s=1,a=arguments.length;s<a;s++){i=arguments[s];for(var c in i)Object.prototype.hasOwnProperty.call(i,c)&&(n[c]=i[c])}return n},cn=function(n,i){var s={};for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&i.indexOf(a)<0&&(s[a]=n[a]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var c=0,a=Object.getOwnPropertySymbols(n);c<a.length;c++)i.indexOf(a[c])<0&&Object.prototype.propertyIsEnumerable.call(n,a[c])&&(s[a[c]]=n[a[c]]);return s},ln=function(n,i,s,a){var c=arguments.length,d=c<3?i:a===null?a=Object.getOwnPropertyDescriptor(i,s):a,f;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(n,i,s,a);else for(var v=n.length-1;v>=0;v--)(f=n[v])&&(d=(c<3?f(d):c>3?f(i,s,d):f(i,s))||d);return c>3&&d&&Object.defineProperty(i,s,d),d},dn=function(n,i){return function(s,a){i(s,a,n)}},un=function(n,i){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,i)},pn=function(n,i,s,a){function c(d){return d instanceof s?d:new s(function(f){f(d)})}return new(s||(s=Promise))(function(d,f){function v(j){try{x(a.next(j))}catch(ce){f(ce)}}function L(j){try{x(a.throw(j))}catch(ce){f(ce)}}function x(j){j.done?d(j.value):c(j.value).then(v,L)}x((a=a.apply(n,i||[])).next())})},fn=function(n,i){var s={label:0,sent:function(){if(d[0]&1)throw d[1];return d[1]},trys:[],ops:[]},a,c,d,f;return f={next:v(0),throw:v(1),return:v(2)},typeof Symbol=="function"&&(f[Symbol.iterator]=function(){return this}),f;function v(x){return function(j){return L([x,j])}}function L(x){if(a)throw new TypeError("Generator is already executing.");for(;s;)try{if(a=1,c&&(d=x[0]&2?c.return:x[0]?c.throw||((d=c.return)&&d.call(c),0):c.next)&&!(d=d.call(c,x[1])).done)return d;switch(c=0,d&&(x=[x[0]&2,d.value]),x[0]){case 0:case 1:d=x;break;case 4:return s.label++,{value:x[1],done:!1};case 5:s.label++,c=x[1],x=[0];continue;case 7:x=s.ops.pop(),s.trys.pop();continue;default:if(d=s.trys,!(d=d.length>0&&d[d.length-1])&&(x[0]===6||x[0]===2)){s=0;continue}if(x[0]===3&&(!d||x[1]>d[0]&&x[1]<d[3])){s.label=x[1];break}if(x[0]===6&&s.label<d[1]){s.label=d[1],d=x;break}if(d&&s.label<d[2]){s.label=d[2],s.ops.push(x);break}d[2]&&s.ops.pop(),s.trys.pop();continue}x=i.call(n,s)}catch(j){x=[6,j],c=0}finally{a=d=0}if(x[0]&5)throw x[1];return{value:x[0]?x[1]:void 0,done:!0}}},mn=function(n,i){for(var s in n)s!=="default"&&!Object.prototype.hasOwnProperty.call(i,s)&&We(i,n,s)},We=Object.create?function(n,i,s,a){a===void 0&&(a=s),Object.defineProperty(n,a,{enumerable:!0,get:function(){return i[s]}})}:function(n,i,s,a){a===void 0&&(a=s),n[a]=i[s]},Fe=function(n){var i=typeof Symbol=="function"&&Symbol.iterator,s=i&&n[i],a=0;if(s)return s.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&a>=n.length&&(n=void 0),{value:n&&n[a++],done:!n}}};throw new TypeError(i?"Object is not iterable.":"Symbol.iterator is not defined.")},Ht=function(n,i){var s=typeof Symbol=="function"&&n[Symbol.iterator];if(!s)return n;var a=s.call(n),c,d=[],f;try{for(;(i===void 0||i-- >0)&&!(c=a.next()).done;)d.push(c.value)}catch(v){f={error:v}}finally{try{c&&!c.done&&(s=a.return)&&s.call(a)}finally{if(f)throw f.error}}return d},gn=function(){for(var n=[],i=0;i<arguments.length;i++)n=n.concat(Ht(arguments[i]));return n},yn=function(){for(var n=0,i=0,s=arguments.length;i<s;i++)n+=arguments[i].length;for(var a=Array(n),c=0,i=0;i<s;i++)for(var d=arguments[i],f=0,v=d.length;f<v;f++,c++)a[c]=d[f];return a},de=function(n){return this instanceof de?(this.v=n,this):new de(n)},hn=function(n,i,s){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var a=s.apply(n,i||[]),c,d=[];return c={},f("next"),f("throw"),f("return"),c[Symbol.asyncIterator]=function(){return this},c;function f(I){a[I]&&(c[I]=function(le){return new Promise(function(Pt,vo){d.push([I,le,Pt,vo])>1||v(I,le)})})}function v(I,le){try{L(a[I](le))}catch(Pt){ce(d[0][3],Pt)}}function L(I){I.value instanceof de?Promise.resolve(I.value.v).then(x,j):ce(d[0][2],I)}function x(I){v("next",I)}function j(I){v("throw",I)}function ce(I,le){I(le),d.shift(),d.length&&v(d[0][0],d[0][1])}},bn=function(n){var i,s;return i={},a("next"),a("throw",function(c){throw c}),a("return"),i[Symbol.iterator]=function(){return this},i;function a(c,d){i[c]=n[c]?function(f){return(s=!s)?{value:de(n[c](f)),done:c==="return"}:d?d(f):f}:d}},vn=function(n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i=n[Symbol.asyncIterator],s;return i?i.call(n):(n=typeof Fe=="function"?Fe(n):n[Symbol.iterator](),s={},a("next"),a("throw"),a("return"),s[Symbol.asyncIterator]=function(){return this},s);function a(d){s[d]=n[d]&&function(f){return new Promise(function(v,L){f=n[d](f),c(v,L,f.done,f.value)})}}function c(d,f,v,L){Promise.resolve(L).then(function(x){d({value:x,done:v})},f)}},xn=function(n,i){return Object.defineProperty?Object.defineProperty(n,"raw",{value:i}):n.raw=i,n};var r=Object.create?function(n,i){Object.defineProperty(n,"default",{enumerable:!0,value:i})}:function(n,i){n.default=i};wn=function(n){if(n&&n.__esModule)return n;var i={};if(n!=null)for(var s in n)s!=="default"&&Object.prototype.hasOwnProperty.call(n,s)&&We(i,n,s);return r(i,n),i},Sn=function(n){return n&&n.__esModule?n:{default:n}},kn=function(n,i){if(!i.has(n))throw new TypeError("attempted to get private field on non-instance");return i.get(n)},An=function(n,i,s){if(!i.has(n))throw new TypeError("attempted to set private field on non-instance");return i.set(n,s),s},t("__extends",sn),t("__assign",an),t("__rest",cn),t("__decorate",ln),t("__param",dn),t("__metadata",un),t("__awaiter",pn),t("__generator",fn),t("__exportStar",mn),t("__createBinding",We),t("__values",Fe),t("__read",Ht),t("__spread",gn),t("__spreadArrays",yn),t("__await",de),t("__asyncGenerator",hn),t("__asyncDelegator",bn),t("__asyncValues",vn),t("__makeTemplateObject",xn),t("__importStar",wn),t("__importDefault",Sn),t("__classPrivateFieldGet",kn),t("__classPrivateFieldSet",An)})});var On=V(K=>{"use strict";Object.defineProperty(K,"__esModule",{value:!0});K.sum=K.subtract=K.add=K.increment=void 0;function Eo(t){return t+1}K.increment=Eo;function Po(t,e){return e===void 0?r=>t+r:t+e}K.add=Po;function Io(t,e){return e===void 0?r=>r-t:t-e}K.subtract=Io;K.sum=(t,e)=>t+e});var qt=V(M=>{"use strict";Object.defineProperty(M,"__esModule",{value:!0});M.AsyncSequence=M.Sequence=M.sequence=M.range=M.repeat=M.iterate=void 0;var Mt=On(),Cn=$e(),Dt=Q();function*Ve(t,e){for(;;)yield e,e=t(e)}M.iterate=Ve;function*Ro(t){for(;;)yield t()}M.repeat=Ro;function*Lo(t,e,r=1){if(r===0)throw new Error("step can not be 0");if(e===void 0)yield*Ve(Mt.add(r),t);else{let n=Math.abs(r);e<t?yield*Bt(Ve(Mt.subtract(n),t),Cn.takeWhile(i=>i>=e)):yield*Bt(Ve(Mt.add(n),t),Cn.takeWhile(i=>i<=e))}}M.range=Lo;function Bt(t,...e){return Dt.isIterable(t)?new Ne(t,e):Dt.isArrayLike(t)?new Ne(Dt.iterable(t),e):new jt(t,e)}M.sequence=Bt;var Ne=class{constructor(e,r){this.source=e,this.transducers=r}[Symbol.iterator](){return this.transducers.reduce((e,r)=>r.sync(e),this.source)[Symbol.iterator]()}};M.Sequence=Ne;var jt=class{constructor(e,r){this.source=e,this.transducers=r}[Symbol.asyncIterator](){return this.transducers.reduce((e,r)=>r.async_(e),this.source)[Symbol.asyncIterator]()}};M.AsyncSequence=jt});var Q=V(w=>{"use strict";Object.defineProperty(w,"__esModule",{value:!0});w.AsyncIteratorHandler=w.single=w.by=w.toAsyncIterable=w.array=w.isArrayLike=w.asyncIterable=w.iterable=w.toIterable=w.isPromiseLike=w.isAsyncIterable=w.isIterable=w.value=w.key=w.comparators=w.descending=w.ascending=void 0;var J=ze(),Je=qt();function Ye(t,e){return t<e?-1:t>e?1:0}w.ascending=Ye;function Ho(t,e){return t<e?1:t>e?-1:0}w.descending=Ho;function Mo(...t){return(e,r)=>{for(let n of t){let i=n(e,r);if(i!=0)return i}return 0}}w.comparators=Mo;function Do(t){return Object.assign(e=>e[t],{name:t})}w.key=Do;function Bo(t){return e=>e[t]}w.value=Bo;function Ut(t){return typeof t=="object"&&Symbol.iterator in t}w.isIterable=Ut;function jo(t){return typeof t=="object"&&Symbol.asyncIterator in t}w.isAsyncIterable=jo;function qo(t){return typeof t=="object"&&"then"in t}w.isPromiseLike=qo;function Uo(...t){return t}w.toIterable=Uo;function*_o(t){for(let e=0;e<t.length;e++)yield t[e]}w.iterable=_o;function Go(t){return J.__asyncGenerator(this,arguments,function*(){for(let r of t)yield yield J.__await(r)})}w.asyncIterable=Go;function Tn(t){return typeof t=="object"&&typeof t.length=="number"}w.isArrayLike=Tn;function Fo(t,...e){return Ut(t)||Tn(t)?Wo(Je.sequence(t,...e)):Ko(Je.sequence(t,...e))}w.array=Fo;function Wo(t){let e=[];for(let r of t)e.push(r);return e}function Ko(t){var e,r,n,i;return J.__awaiter(this,void 0,void 0,function*(){let s=[];try{for(e=J.__asyncValues(t);r=yield e.next(),!r.done;){let a=r.value;s.push(a)}}catch(a){n={error:a}}finally{try{r&&!r.done&&(i=e.return)&&(yield i.call(e))}finally{if(n)throw n.error}}return s})}function zo(t){return J.__asyncGenerator(this,arguments,function*(){yield yield J.__await(t)})}w.toAsyncIterable=zo;function Vo(t,e=Ye){return typeof t=="function"?$o(t,e):No(t,e)}w.by=Vo;function No(t,e=Ye){return(r,n)=>e(r[t],n[t])}function $o(t,e=Ye){return(r,n)=>e(t(r),t(n))}function Jo(t,...e){return Ut(t)?Yo(Je.sequence(t,...e)):Zo(Je.sequence(t,...e))}w.single=Jo;function Yo(t){for(let e of t)return e;throw new Error("Expected a single value")}function Zo(t){var e,r,n,i;return J.__awaiter(this,void 0,void 0,function*(){try{for(e=J.__asyncValues(t);r=yield e.next(),!r.done;)return r.value}catch(s){n={error:s}}finally{try{r&&!r.done&&(i=e.return)&&(yield i.call(e))}finally{if(n)throw n.error}}throw new Error("Expected a single value")})}var En=class{constructor(){this.handlers=[],this.state=[]}value(e){this.newState({value:e,done:!1})}error(e){this.newState(e)}close(){this.newState({value:void 0,done:!0})}[Symbol.asyncIterator](){return this}next(){return new Promise((e,r)=>{this.newHandler([e,r])})}newState(e){let r=this.handlers.shift();if(typeof r=="undefined")return this.state.push(e);let n=this.state.shift();if(typeof n=="undefined")return this.consume(e,r);this.consume(n,r),this.newState(e)}newHandler(e){let r=this.state.shift();if(typeof r=="undefined")return this.handlers.push(e);let n=this.handlers.shift();if(typeof n=="undefined")return this.consume(r,e);this.consume(r,n),this.newHandler(e)}consume(e,[r,n]){e instanceof Error?n(e):r(e)}};w.AsyncIteratorHandler=En});var be=V(Y=>{"use strict";Object.defineProperty(Y,"__esModule",{value:!0});Y.container=Y.lazy=Y.replace=void 0;function Pn(t,e,r){return Object.defineProperty(t,e,{value:r})}Y.replace=Pn;function In(t,e,r){if(typeof r.get=="undefined")throw new Error("@lazy can only decorate getter methods");return Object.defineProperty(t,e,Object.assign(Object.assign({},r),{get(){return Pn(this,e,r.get.call(this))[e]}}))}Y.lazy=In;function Qo(t){return Object.keys(t).reduce((e,r)=>In(e,r,{configurable:!0,get:()=>t[r](e)}),{})}Y.container=Qo});var qn=V(Qe=>{"use strict";Object.defineProperty(Qe,"__esModule",{value:!0});Qe.AVLTree=void 0;var Rn=ze(),Ze=Q(),Ln=be(),z=class{constructor(e){this.comparator=e}static empty(e=Ze.ascending){return new Hn(e)}static create(e,r,n=Ze.ascending){let i=z.empty(n);return new F(n,e,r,i,i)}static of(e,r=Ze.ascending){return z.preSorted(e.sort(Ze.by(0)),r,z.empty(r))}static preSorted(e,r,n){let i=e.length;switch(i){case 0:return n;case 1:{let[[s,a]]=e;return new F(r,s,a,n,n)}default:{let s=Math.floor(i/2),a=z.preSorted(e.slice(0,s),r,n),c=z.preSorted(e.slice(s+1),r,n),[d,f]=e[s];return new F(r,d,f,a,c)}}}};Qe.AVLTree=z;var Hn=class extends z{constructor(e){super(e);this.isEmpty=!0,this.height=0,this.balance=0}insert(e,r){return new F(this.comparator,e,r,this,this)}contains(e){return!1}lookup(e){}delete(e){return{tree:this}}first(){}last(){}removeFirst(){return{tree:this}}removeLast(){return{tree:this}}toString(){return""}*keys(){}*values(){}*entries(){return[]}},F=class extends z{constructor(e,r,n,i,s){super(e);this.key=r,this.value=n,this.left=i,this.right=s,this.isEmpty=!1}insert(e,r){let n=this.comparator(e,this.key);return n===0?new F(this.comparator,e,r,this.left,this.right):n<0?this.replaceLeft(this.left.insert(e,r)):this.replaceRight(this.right.insert(e,r))}contains(e){let r=this.comparator(e,this.key);return r===0?!0:r<0?this.left.contains(e):this.right.contains(e)}lookup(e){let r=this.comparator(e,this.key);return r===0?this.value:r<0?this.left.lookup(e):this.right.lookup(e)}delete(e){let r=this.comparator(e,this.key);if(r===0){if(this.left.isEmpty)return{tree:this.right,key:this.key,value:this.value};if(this.right.isEmpty)return{tree:this.left,key:this.key,value:this.value};let{tree:a,key:c,value:d}=this.left.removeLast();return{tree:_t(new F(this.comparator,c,d,a,this.right)),key:this.key,value:this.value}}if(r<0){let{tree:a,key:c,value:d}=this.left.delete(e);return{tree:this.replaceLeft(a),key:c,value:d}}let{tree:n,key:i,value:s}=this.right.delete(e);return{tree:this.replaceRight(n),key:i,value:s}}first(){return this.left.isEmpty?this.value:this.left.first()}last(){return this.right.isEmpty?this.value:this.right.last()}removeFirst(){if(this.left.isEmpty)return{tree:this.right,key:this.key,value:this.value};let{tree:e,key:r,value:n}=this.left.removeFirst();return{tree:this.replaceLeft(e),key:r,value:n}}removeLast(){if(this.right.isEmpty)return{tree:this.left,key:this.key,value:this.value};let{tree:e,key:r,value:n}=this.right.removeLast();return{tree:this.replaceRight(e),key:r,value:n}}replaceLeft(e){return _t(new F(this.comparator,this.key,this.value,e,this.right))}replaceRight(e){return _t(new F(this.comparator,this.key,this.value,this.left,e))}toString(){return`(${this.left} ${this.key}=${this.value} ${this.right})`}get balance(){return this.left.height-this.right.height}get height(){return Math.max(this.left.height,this.right.height)+1}*keys(){yield*this.left.keys(),yield this.key,yield*this.right.keys()}*values(){yield*this.left.values(),yield this.value,yield*this.right.values()}*entries(){yield*this.left.entries(),yield[this.key,this.value],yield*this.right.entries()}};Rn.__decorate([Ln.lazy],F.prototype,"balance",null);Rn.__decorate([Ln.lazy],F.prototype,"height",null);function _t(t){let e=t.balance;return e==-2?es(t):e==2?Xo(t):t}function Xo(t){let e=t.left.balance;return e==-1?ts(t):e==1?Mn(t):t}function es(t){let e=t.right.balance;return e==1?rs(t):e==-1?Dn(t):t}function Mn(t){return jn(t)}function ts(t){let e=Bn(t.left);return Mn(t.replaceLeft(e))}function Dn(t){return Bn(t)}function rs(t){let e=jn(t.right);return Dn(t.replaceRight(e))}function Bn(t){let e=t.right,r=e.left,n=t.replaceRight(r);return e.replaceLeft(n)}function jn(t){let e=t.left,r=e.right,n=t.replaceLeft(r);return e.replaceRight(n)}});var $e=V(g=>{"use strict";Object.defineProperty(g,"__esModule",{value:!0});g.WindowedTransducer=g.windowed=g.unique=g.UniqueTransducer=g.dedupe=g.DedupTransducer=g.sort=g.SortTransducer=g.takeWhile=g.TakeWhileTransducer=g.dropWhile=g.DropWhileTransducer=g.drop=g.DropTransducer=g.take=g.TakeTransducer=g.reduce=g.scan=g.ScanTransducer=g.decompose=g.compose=g.CompositeTransducer=g.find=g.reject=g.filter=g.FilterTransducer=g.flatMap=g.FlatMapTransducer=g.zipWithIndex=g.zip=g.ZipTransducer=g.map=g.MapTransducer=g.last=g.LastTransducer=g.first=g.FirstTransducer=g.transducer=g.identity=g.IdentityTransducer=void 0;var m=ze(),X=Q(),Un=qn(),ns=qt(),Gt=class{async_(e){return e}sync(e){return e}};g.IdentityTransducer=Gt;function _n(){return new Gt}g.identity=_n;g.transducer=_n;var Ft=class{async_(e){return m.__asyncGenerator(this,arguments,function*(){var n,i;try{for(var s=m.__asyncValues(e),a;a=yield m.__await(s.next()),!a.done;){let c=a.value;return yield m.__await(yield yield m.__await(c))}}catch(c){n={error:c}}finally{try{a&&!a.done&&(i=s.return)&&(yield m.__await(i.call(s)))}finally{if(n)throw n.error}}})}*sync(e){for(let r of e)return yield r}};g.FirstTransducer=Ft;function Gn(){return new Ft}g.first=Gn;var Wt=class{async_(e){return m.__asyncGenerator(this,arguments,function*(){var n,i;let s;try{for(var a=m.__asyncValues(e),c;c=yield m.__await(a.next()),!c.done;)s=c.value}catch(d){n={error:d}}finally{try{c&&!c.done&&(i=a.return)&&(yield m.__await(i.call(a)))}finally{if(n)throw n.error}}s!==void 0&&(yield yield m.__await(s))})}*sync(e){let r;for(r of e);r!==void 0&&(yield r)}};g.LastTransducer=Wt;function Fn(){return new Wt}g.last=Fn;var Kt=class{constructor(e){this.mapper=e}async_(e){return m.__asyncGenerator(this,arguments,function*(){var n,i;try{for(var s=m.__asyncValues(e),a;a=yield m.__await(s.next()),!a.done;){let c=a.value;yield yield m.__await(this.mapper(c))}}catch(c){n={error:c}}finally{try{a&&!a.done&&(i=s.return)&&(yield m.__await(i.call(s)))}finally{if(n)throw n.error}}})}*sync(e){for(let r of e)yield this.mapper(r)}};g.MapTransducer=Kt;function is(t){return new Kt(t)}g.map=is;var Xe=class{constructor(e){this.other=e}async_(e){return m.__asyncGenerator(this,arguments,function*(){if(!X.isAsyncIterable(this.other))throw new Error("Unsupported operation exception");let n=e[Symbol.asyncIterator](),i=this.other[Symbol.asyncIterator]();for(;;){let[s,a]=yield m.__await(Promise.all([n.next(),i.next()]));if(s.done||a.done)return yield m.__await(void 0);yield yield m.__await([s.value,a.value])}})}*sync(e){if(!X.isIterable(this.other))throw new Error("Unsupported operation exception");let r=e[Symbol.iterator](),n=this.other[Symbol.iterator]();for(;;){let i=r.next(),s=n.next();if(i.done||s.done)return;yield[i.value,s.value]}}};g.ZipTransducer=Xe;function os(t){return new Xe(t)}g.zip=os;function ss(){return new Xe(ns.range(0))}g.zipWithIndex=ss;var zt=class{constructor(e){this.mapper=e}async_(e){return m.__asyncGenerator(this,arguments,function*(){var n,i;try{for(var s=m.__asyncValues(e),a;a=yield m.__await(s.next()),!a.done;){let c=a.value;yield m.__await(yield*m.__asyncDelegator(m.__asyncValues(this.mapper(c))))}}catch(c){n={error:c}}finally{try{a&&!a.done&&(i=s.return)&&(yield m.__await(i.call(s)))}finally{if(n)throw n.error}}})}*sync(e){for(let r of e)yield*this.mapper(r)}};g.FlatMapTransducer=zt;function as(t){return new zt(t)}g.flatMap=as;var et=class{constructor(e){this.predicate=e}async_(e){return m.__asyncGenerator(this,arguments,function*(){var n,i;try{for(var s=m.__asyncValues(e),a;a=yield m.__await(s.next()),!a.done;){let c=a.value;this.predicate(c)&&(yield yield m.__await(c))}}catch(c){n={error:c}}finally{try{a&&!a.done&&(i=s.return)&&(yield m.__await(i.call(s)))}finally{if(n)throw n.error}}})}*sync(e){for(let r of e)this.predicate(r)&&(yield r)}};g.FilterTransducer=et;function Wn(t){return new et(t)}g.filter=Wn;function cs(t){return new et(e=>!t(e))}g.reject=cs;function ls(t){return Vt(Wn(t),Gn())}g.find=ls;var tt=class{constructor(e,r){this.a=e,this.b=r}async_(e){return this.b.async_(this.a.async_(e))}sync(e){return this.b.sync(this.a.sync(e))}};g.CompositeTransducer=tt;function Vt(t,e){return new tt(t,e)}g.compose=Vt;function*Nt(t){t instanceof tt?(yield*Nt(t.a),yield*Nt(t.b)):yield t}g.decompose=Nt;var $t=class{constructor(e,r){this.reducer=e,this.seed=r}async_(e){return m.__asyncGenerator(this,arguments,function*(){var n,i;let s=this.seed;yield yield m.__await(s);try{for(var a=m.__asyncValues(e),c;c=yield m.__await(a.next()),!c.done;){let d=c.value;yield yield m.__await(s=this.reducer(s,d))}}catch(d){n={error:d}}finally{try{c&&!c.done&&(i=a.return)&&(yield m.__await(i.call(a)))}finally{if(n)throw n.error}}})}*sync(e){let r=this.seed;yield r;for(let n of e)yield r=this.reducer(r,n)}};g.ScanTransducer=$t;function Kn(t,e){return new $t(t,e)}g.scan=Kn;function ds(t,e){return Vt(Kn(t,e),Fn())}g.reduce=ds;var Jt=class{constructor(e){if(this.count=e,typeof e=="undefined")throw new Error("Count can not be undefined")}async_(e){return m.__asyncGenerator(this,arguments,function*(){var n,i;if(this.count<1)return yield m.__await(void 0);try{for(var s=m.__asyncValues(e),a;a=yield m.__await(s.next()),!a.done;){let c=a.value;if(yield yield m.__await(c),--this.count<1)return yield m.__await(void 0)}}catch(c){n={error:c}}finally{try{a&&!a.done&&(i=s.return)&&(yield m.__await(i.call(s)))}finally{if(n)throw n.error}}})}*sync(e){if(!(this.count<1)){for(let r of e)if(yield r,--this.count<1)return}}};g.TakeTransducer=Jt;function us(t){return new Jt(t)}g.take=us;var Yt=class{constructor(e){if(this.count=e,typeof e=="undefined")throw new Error("Count can not be undefined")}async_(e){return m.__asyncGenerator(this,arguments,function*(){var n,i;try{for(var s=m.__asyncValues(e),a;a=yield m.__await(s.next()),!a.done;){let c=a.value;--this.count<0&&(yield yield m.__await(c))}}catch(c){n={error:c}}finally{try{a&&!a.done&&(i=s.return)&&(yield m.__await(i.call(s)))}finally{if(n)throw n.error}}})}*sync(e){for(let r of e)--this.count<0&&(yield r)}};g.DropTransducer=Yt;function ps(t){return new Yt(t)}g.drop=ps;var Zt=class{constructor(e){this.predicate=e}async_(e){return m.__asyncGenerator(this,arguments,function*(){var n,i;let s=!0;try{for(var a=m.__asyncValues(e),c;c=yield m.__await(a.next()),!c.done;){let d=c.value;s&&(s=this.predicate(d)),s||(yield yield m.__await(d))}}catch(d){n={error:d}}finally{try{c&&!c.done&&(i=a.return)&&(yield m.__await(i.call(a)))}finally{if(n)throw n.error}}})}*sync(e){let r=!0;for(let n of e)r&&(r=this.predicate(n)),r||(yield n)}};g.DropWhileTransducer=Zt;function fs(t){return new Zt(t)}g.dropWhile=fs;var Qt=class{constructor(e){this.predicate=e}async_(e){return m.__asyncGenerator(this,arguments,function*(){var n,i;try{for(var s=m.__asyncValues(e),a;a=yield m.__await(s.next()),!a.done;){let c=a.value;if(this.predicate(c))yield yield m.__await(c);else return yield m.__await(void 0)}}catch(c){n={error:c}}finally{try{a&&!a.done&&(i=s.return)&&(yield m.__await(i.call(s)))}finally{if(n)throw n.error}}})}*sync(e){for(let r of e)if(this.predicate(r))yield r;else return}};g.TakeWhileTransducer=Qt;function ms(t){return new Qt(t)}g.takeWhile=ms;var Xt=class{constructor(e){this.comparator=e}async_(e){return m.__asyncGenerator(this,arguments,function*(){let n=yield m.__await(X.array(e));n.sort(this.comparator),yield m.__await(yield*m.__asyncDelegator(m.__asyncValues(n)))})}*sync(e){let r=X.array(e);r.sort(this.comparator),yield*r}};g.SortTransducer=Xt;function gs(t=X.ascending){return new Xt(t)}g.sort=gs;var er=class{constructor(e){this.comparator=e}async_(e){return m.__asyncGenerator(this,arguments,function*(){var n,i;let s;try{for(var a=m.__asyncValues(e),c;c=yield m.__await(a.next()),!c.done;){let d=c.value;typeof s=="undefined"?yield yield m.__await(d):this.comparator(d,s)!==0&&(yield yield m.__await(d)),s=d}}catch(d){n={error:d}}finally{try{c&&!c.done&&(i=a.return)&&(yield m.__await(i.call(a)))}finally{if(n)throw n.error}}})}*sync(e){let r;for(let n of e)typeof r=="undefined"?yield n:this.comparator(n,r)!==0&&(yield n),r=n}};g.DedupTransducer=er;function ys(t=X.ascending){return new er(t)}g.dedupe=ys;var tr=class{constructor(e){this.comparator=e}async_(e){return m.__asyncGenerator(this,arguments,function*(){var n,i;let s=Un.AVLTree.empty(this.comparator);try{for(var a=m.__asyncValues(e),c;c=yield m.__await(a.next()),!c.done;){let d=c.value;s.contains(d)||(s=s.insert(d,void 0),yield yield m.__await(d))}}catch(d){n={error:d}}finally{try{c&&!c.done&&(i=a.return)&&(yield m.__await(i.call(a)))}finally{if(n)throw n.error}}})}*sync(e){let r=Un.AVLTree.empty(this.comparator);for(let n of e)r.contains(n)||(r=r.insert(n,void 0),yield n)}};g.UniqueTransducer=tr;function hs(t=X.ascending){return new tr(t)}g.unique=hs;function bs(t,e=1,r=!1){return new rr(t,e,r)}g.windowed=bs;var rr=class{constructor(e,r,n){this.size=e,this.step=r,this.remainder=n}async_(e){return m.__asyncGenerator(this,arguments,function*(){var n,i;let s=[],a=0;try{for(var c=m.__asyncValues(e),d;d=yield m.__await(c.next()),!d.done;){let f=d.value;if(a>0){a--;continue}s.push(f),s.length===this.size&&(yield yield m.__await([...s]),s=s.slice(this.step),this.step>this.size&&(a=this.step-this.size))}}catch(f){n={error:f}}finally{try{d&&!d.done&&(i=c.return)&&(yield m.__await(i.call(c)))}finally{if(n)throw n.error}}this.remainder&&(yield yield m.__await([...s]))})}*sync(e){let r=[],n=0;for(let i of e){if(n>0){n--;continue}r.push(i),r.length===this.size&&(yield[...r],r=r.slice(this.step),this.step>this.size&&(n=this.step-this.size))}this.remainder&&(yield[...r])}};g.WindowedTransducer=rr});var pe=V(ue=>{"use strict";Object.defineProperty(ue,"__esModule",{value:!0});ue.caching=ue.cache=void 0;function ws(t,e,r){if(typeof r.value!="function")throw new Error("@cache can only decorate methods");let n=new WeakMap;function i(s){let a=n.get(s);if(a)return a;let c=new Map;return n.set(s,c),c}return Object.defineProperty(t,e,Object.assign(Object.assign({},r),{value:function(...s){let a=JSON.stringify(s),c=i(this),d=c.get(a);if(typeof d!="undefined"||c.has(a))return d;let f=r.value.call(this,...s);return c.set(a,f),f}}))}ue.cache=ws;function Ss(t){let e=new Map;return function(...r){let n=JSON.stringify(r),i=e.get(n);if(typeof i!="undefined"||e.has(n))return i;let s=t(...r);return e.set(n,s),s}}ue.caching=Ss});var xt=V(ge=>{"use strict";Object.defineProperty(ge,"__esModule",{value:!0});ge.StoppedClock=ge.SystemClock=void 0;var Qi=class{now(){return new Date}};ge.SystemClock=Qi;var Xi=class{constructor(e){this.value=e}now(){return this.value}};ge.StoppedClock=Xi});var Rt=class{constructor(e){let r=Rt.RFC_3986.exec(e);if(!r)throw new Error(`Invalid Uri: ${e}`);let[,,n,,i,s,,a,,c]=r;this.scheme=n,this.authority=i?new It(i):void 0,this.path=s,this.query=a,this.fragment=c}toString(){let e=[];return typeof this.scheme!="undefined"&&e.push(this.scheme,":"),typeof this.authority!="undefined"&&e.push("//",this.authority.toString()),e.push(this.path),typeof this.query!="undefined"&&e.push("?",this.query),typeof this.fragment!="undefined"&&e.push("#",this.fragment),e.join("")}get host(){return this.authority&&this.authority.host}get port(){return this.authority&&this.authority.port}get userInfo(){return this.authority&&this.authority.userInfo}},S=Rt;S.RFC_3986=/^(([^:/?#]+):)?(\/\/([^/?#]*))?([^?#]*)(\?([^#]*))?(#(.*))?/;var Lt=class{constructor(e){let r=Lt.RFC_3986.exec(e);if(!r)throw new Error(`Invalid Authority: ${e}`);let[,n,i,s]=r;this.userInfo=n,this.host=i,this.port=s}toString(){let e=[];return typeof this.userInfo!="undefined"&&e.push(this.userInfo,"@"),typeof this.host!="undefined"&&e.push(this.host),typeof this.port!="undefined"&&e.push(":",this.port),e.join("")}},It=Lt;It.RFC_3986=/(?:([^@]+)@)?([^:]+)(?::([\d]+))?/;var zn=R($e()),nr=R(Q());function vs(t){switch(typeof t){case"undefined":return!0;case"string":return t.trim()==="";case"number":return isNaN(t);case"object":{if(t==null)return!0;if(y.isObject(t))return Object.keys(t).length===0;if(Array.isArray(t))return t.length===0}}return!1}var q=class{static noWhitespace(e){return e&&typeof e=="string"?e.replace(/\s+/g,""):""}static startWith(e,r){return e?e.substring(0,r.length)===r:e===r}static endsWith(e,r){return e.substring(e.length-r.length,e.length)===r}static isEmpty(e){return e===void 0||e===null?!0:e.trim().length===0}static isLowerCase(e){return e===e.toLowerCase()&&e!==e.toUpperCase()}static isUpperCase(e){return e===e.toUpperCase()&&e!==e.toLowerCase()}static kebabCase(e){return q.delimiterCase(e,"-")}static snakeCase(e){return q.delimiterCase(e,"_")}static delimiterCase(e,r){return e.replace(/([A-Z][a-z]+|\d+)/gm,`${r}$1`).replace(new RegExp(`^${r}`),"").toLowerCase()}static titleCase(e){return q.isEmpty(e)?"":e.replace(/\w\S*/g,r=>r.charAt(0).toUpperCase()+r.substr(1).toLowerCase())}static camelCase(e){return q.isEmpty(e)?"":e.replace(/([A-Za-z]+|\d+)/gm,r=>r.charAt(0).toUpperCase()+r.substr(1).toLowerCase()).replace(new RegExp("^."),r=>r.toLowerCase()).replace(new RegExp(/[_\-\s]/g),"")}};function ve(t,e,r){if(e(t))return r(t);switch(typeof t){case"undefined":return;case"object":{if(t===null)return null;if(Array.isArray(t))return t.map(n=>ve(n,e,r));if(y.isObject(t))return y.keys(t).sort().reduce((n,i)=>{let s=t[i];return n[i]=ve(s,e,r),n},{})}}return t}function rt(t,e){switch(typeof t){case"undefined":return;case"object":{if(t===null)return null;if(Array.isArray(t))return t.map(r=>rt(r,e));if(y.isObject(t))return y.keys(t).sort().reduce((r,n)=>{let i=t[n];return r[e(String(n))]=rt(i,e),r},{})}}return t}var y=class{static isObject(e){return e&&typeof e=="object"&&(e.constructor===Object||/Object.*native/.test(e.constructor.toString()))}static keys(e){return Object.keys(e)}static values(e){return Object.keys(e).map(r=>e[r])}static entries(e){return Object.keys(e).map(r=>[r,e[r]])}static removeEmpty(e){return e&&(y.isObject(e)?Object.keys(e).reduce((r,n)=>{let i=y.removeEmpty(e[n]);return vs(i)||(r[n]=i),r},{}):e)}static sort(e){return e&&(Array.isArray(e)?e.map(y.sort):y.isObject(e)?Object.keys(e).sort().reduce((r,n)=>{let i=e[n];return r[n]=y.sort(i),r},{}):e)}static toLowerCase(e){return typeof e=="string"?e.toLowerCase():Array.isArray(e)?e.map(y.toLowerCase):p(()=>y.isObject(e))?Object.entries(e).reduce((r,[n,i])=>(r[n]=y.toLowerCase(i),r),{}):e}static snakeCase(e){return rt(e,q.snakeCase)}static camelCase(e){return rt(e,q.camelCase)}static filter(e,r){let n=y.keys(e).filter(r);return y.pick(e,...n)}static omit(e,...r){return r.reduce((n,i)=>(Reflect.deleteProperty(n,i),n),e)}static pick(e,...r){return r.reduce((n,i)=>(n[i]=e[i],n),{})}};var T=class{static from(e){return Array.from(e)}static find(e,r){if(e.find)return e.find(r);let[n]=e.filter(r);return n}static findLastIndex(e,r){let n=[...e].reverse().findIndex(r);return n===-1?n:e.length-n-1}static toObject(e){return e.reduce((r,n)=>(Object.keys(n).forEach(i=>{i in r||(r[i]=n[i])}),r),{})}static flatten(e){return e.reduce((r,n)=>r.concat(n),[])}static flatMap(e,r){return e.flatMap?e.flatMap(r):T.flatten(e.map(r))}static unique(e){return Array.from(new Set(e))}static clean(e){return e.filter(Boolean)}static trim(e){return e.map(r=>r.trim())}static includes(e,r){return"includes"in e?e.includes(r):e.indexOf(r)!==-1}static first(e){return e[0]}static last(e){return e[e.length-1]}static safeReverse(e){return e?e.slice().reverse():[]}static shuffle(e){return e.map(r=>({value:r,order:Math.random()})).sort((0,nr.by)("order")).map(({value:r})=>r)}};function p(t,e=void 0){try{let r=t();return typeof r=="undefined"?e:r}catch(r){return e}}function ee(t,e=void 0){return u(this,null,function*(){try{let r=yield t();return typeof r=="undefined"?e:r}catch(r){return e}})}function xs(t,e){let r=e.toLowerCase(),n=T.find(Object.keys(t),s=>s.toLowerCase()===r);if(!n)return;let i=t[n];return typeof i=="string"?i.trim():i}function nt(t,...e){if(!t)return[];if(Array.isArray(t))return T.clean(T.flatten(t.map(r=>nt(r,...e))));if(typeof t=="object"){let[r,...n]=e,i=xs(t,r);return typeof i=="object"?nt(i,...n):n.length===0&&Boolean(i)?[i]:[]}return[]}var E=(()=>typeof self!="undefined"?self:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof module!="undefined"?module:Function("return this")())();function Vn(t,e,r){let n=t[e];return typeof n=="undefined"?t[e]=r:Array.isArray(n)?n.indexOf(r)==-1&&n.push(r):t[e]=[n,r],t}function Nn(t,e,r,n=i=>i){let i=[],s=0,a;for(;(a=t.exec(e))!=null;)i.push(n(e.substring(s,a.index))),i.push(r(a)),s=t.lastIndex;return i.push(n(e.substring(s))),i.join("")}function $n(t,e){return t.slice(0,e)}var Jn=R(pe()),Yn=R(be());function k(t=E){return t.triptease=t.triptease||{},t.triptease.onboard=t.triptease.onboard||{},{triptease:t.triptease,onboard:t.triptease.onboard}}var te;(function(n){n.Native="native",n.NonNative="non-native",n.NotImplemented="not-implemented"})(te||(te={}));function ir(t,e){return p(()=>e.split(".").reduce((r,n)=>r[n],t))}function Zn(t){return t==null?te.NotImplemented:typeof t=="function"?t.toString().includes("native code")?te.Native:te.NonNative:te.Native}function Qn(t,...e){return e.reduce((r,n)=>(r[n]=Zn(ir(t,n)),r),{})}var it=class{static exposeApi(){let e=k(E).triptease;e.native||(e.native=it)}static getProperty(e){let r=ir(E,e);return Zn(r)!==te.NonNative?r:ir(it.window,e)}static get window(){let e=E;if(!e.document)return e;try{let r=e.document,n=r.querySelector("[name='triptease.native']");if(n)return n.contentWindow;let i=r.createElement("iframe");return i.style.display="none",i.setAttribute("title","blank"),i.setAttribute("aria-hidden","true"),i.setAttribute("name","triptease.native"),r.documentElement.appendChild(i),i.contentWindow}catch(r){return e}}},H=it;C([Jn.cache],H,"getProperty",1),C([Yn.lazy],H,"window",1);var ks=/^\d{4}-\d{2}-\d{2}(?:T\d{2}:\d{2}:\d{2}\.\d{3}Z)?$/;function As(t){return ve(t,e=>typeof e=="string"&&ks.test(e),e=>{let r=new Date(e);return isNaN(r.valueOf())?e:r})}var Os=H.getProperty("JSON.parse"),Cs=H.getProperty("JSON.stringify"),Ts=H.getProperty("Date.prototype.toISOString"),D=class{static parse(e){return Os(e)}static parseWithDates(e){return As(D.parse(e))}static stringify(e){return Cs(this.clean(e))}static clean(e){return ve(e,r=>{let n=typeof r;switch(n){case"undefined":case"string":case"number":case"boolean":return!0;case"object":{if(r===null)return!0;if(Array.isArray(r)||y.isObject(r))return!1;if("toJSON"in r)return!0}}throw new Error(`Illegal JsonValue: ${n} ${r} `)},r=>r instanceof Date?Ts.call(r):r)}},O=class{static same(e,r){return D.stringify(e)===D.stringify(r)}static isSuperset(e,r){return e===null||r===null?O.same(e,r):Array.isArray(e)&&Array.isArray(r)?e.length>r.length?!1:e.every(n=>r.some(i=>O.isSuperset(n,i))):p(()=>y.isObject(e))&&p(()=>y.isObject(r))?Object.keys(e).reduce((n,i)=>n&&O.isSuperset(e[i],r[i]),!0):O.same(e,r)}static compress(e){let r=O.groupValues(e);return this.compressGrouped(r)}static compressGrouped(e){return Object.entries(e).reduce(({shared:r,unique:n},[i,s])=>{if(p(()=>y.isObject(s))){let a=O.compressGrouped(s);Object.keys(a.shared).length>0&&(r[i]=a.shared),a.unique.forEach((c,d)=>{n[d]=n[d]||{},Object.keys(c).length>0&&(n[d][i]=c)})}return Array.isArray(s)&&s.forEach((a,c)=>{n[c]=n[c]||{},T.unique(s.map(d=>D.stringify(d))).length===1?r[i]=a:a!==void 0&&(n[c][i]=a)}),{shared:r,unique:n}},{shared:{},unique:[]})}static groupValues(e){let r=Array.from(e.reduce((a,c)=>Object.keys(c).reduce((d,f)=>d.add(f),a),new Set)),[n,i]=e.reduce((a,c)=>r.reduce(([d,f],v)=>{let L=c[v];return p(()=>y.isObject(L))?(f[v]=f[v]||[],f[v].push(L)):(d[v]=d[v]||[],d[v].push(L)),[d,f]},a),[{},{}]),s=Object.entries(i).reduce((a,[c,d])=>(a[c]=O.groupValues(d),a),{});return A(A({},n),s)}static decompress(e){return e.unique.map(r=>this.merge(e.shared,r))}static merge(e,r){return[...Object.keys(e),...Object.keys(r)].reduce((i,s)=>{let a=e[s],c=r[s];return p(()=>y.isObject(a))&&p(()=>y.isObject(c))?i[s]=O.merge(a,c):i[s]=c!=null?c:a,i},{})}};function U(t,e=!0){return t?(t.indexOf("?")==0&&(t=t.substring(1,t.length)),t.split("&").map(function(r){return r.split("=")}).reduce(function(r,n){let i=n[0],s=n[1];if(!i)return r;let a=Xn(s),c=e?Es(a):a;return Vn(r,Xn(i),c)},{})):{}}function Xn(t){return p(()=>decodeURIComponent(t.replace(/\+/g,"%20")),t)}function Es(t){try{return D.parse(t)}catch(e){return t}}function Ps(t){return typeof t=="string"?t:JSON.stringify(t)}function ei(t,e=!0){return Object.keys(y.removeEmpty(t)).map(r=>{let n=t[r],i=e?Ps(n):n;return`${r}=${encodeURIComponent(i)}`}).join("&")}var ti=H.getProperty("console.log"),Is=H.getProperty("console.error"),Rs=H.getProperty("console.debug"),ri=class{constructor(e=ti,r=Is,n=Rs||ti){this.log=e;this.error=r;this.debug=n}},ni=class{constructor(){this.log=()=>{};this.error=()=>{};this.debug=()=>{}}},ot="triptease-debug",Ls=256;function st(t,e=ot){let r=p(()=>{var n;return U((n=t.location)==null?void 0:n.search,!1)[e]})||p(()=>{var n;return U(new S((n=t.location)==null?void 0:n.originalHref).query,!1)[e]})||p(()=>{var n,i;return(i=(n=t.process)==null?void 0:n.env)==null?void 0:i.DEBUG})||p(()=>{var n;return((n=t.localStorage)==null?void 0:n.getItem)&&t.localStorage.getItem(e)})||p(()=>{var n;return((n=t.sessionStorage)==null?void 0:n.getItem)&&t.sessionStorage.getItem(e)})||"";return p(()=>r.substring(0,Ls),"")}function ii(t=E){let e=st(t,ot);return q.isEmpty(e)?"":ei({[ot]:e})}function Hs(t){return st(t,ot).split(",").map(e=>e.trim())}function oi(t){let e=t.replace(/\./g,"\\.").replace(/\*/g,".*");return new RegExp("^"+e+"$")}function Ms(t,e=E){try{let r=Hs(e),n=r.filter(i=>i[0]==="!").map(i=>i.substr(1));return n.length>0?!n.some(i=>oi(i).test(t)):r.some(i=>i==="true"||oi(i).test(t))}catch(r){return!1}}var si=class{constructor(e){this.name=e;this.console=new ri}debug(e,...r){this.console.debug(`[${this.name}] ${e}`,...r)}log(e,...r){this.console.log(`[${this.name}] ${e}`,...r)}error(e,...r){this.console.error(`[${this.name}] ${e}`,...r)}};function b(t,e=E){return Ms(t,e)?new si(t):new ni}function Ds(t){try{let{target:e,method:r}=sr(t.type);if(e&&r)return!0}catch(e){}return!1}var or=class{constructor(e,r){this.name=e;this.trackingApi=r;this.logger=b(e)}debug(e,...r){this.logger.debug(e,...r)}error(e,...r){this.logger.error(e,...r);try{this.trackingApi.trackError({name:this.name,message:e,args:r.map(n=>xe(n)?qs(n):n)})}catch(n){this.logger.error("Failed to track error",n)}}log(e,...r){this.logger.log(e,...r)}};var N=class{constructor(e,r,n=Bs,i=b("messaging")){this.listener=e;this.target=r;this.allowedOrigins=n;this.logger=i}addListener(e){this.listener&&this.listener.addEventListener("message",r=>{this.disallowedOrigin(r)||!Ds(r.data)||e(r.data,new N(void 0,r.source||this.target))})}disallowedOrigin(e){return e.origin&&this.allowedOrigins.length>0&&this.allowedOrigins.indexOf(new S(e.origin).host)===-1}send(e){if(this.target)try{this.target.postMessage(e,"*")}catch(r){this.target.postMessage(JSON.parse(JSON.stringify(e)),"*")}}},Bs=["onboard.triptease.io","localhost"],js=/^(.*)\.([^.]+)$/;function sr(t){let[,e,r]=t.match(js)||[];return{target:e,method:r}}function ar(t){let e={};return function(...r){let n=JSON.stringify(r),i=e[n];return typeof i!="undefined"?i:e[n]=t(...r)}}function xe(t){return t&&typeof t=="object"&&"name"in t&&typeof t.name=="string"&&"message"in t&&typeof t.message=="string"&&"stack"in t&&typeof t.stack=="string"}function qs(t){return{name:t.name,message:t.message,stack:t.stack}}function cr(t,e,r){return{name:t,message:e,stack:r!=null?r:""}}var Dc=new Set(["Unknown","PossibleIdentifier"]),Bc=new Set(["HotelName","HotelCode","ChainCode"]);var _;(function(f){f.Search="Search",f.RoomsAndRates="RoomsAndRates",f.Confirmation="Confirmation",f.Checkout="Checkout",f.Payment="Payment",f.Group="Group",f.Advert="Advert",f.Partial="Partial",f.Unknown="Unknown"})(_||(_={}));var jc=[_.Payment,_.Confirmation,_.RoomsAndRates,_.Checkout,_.Search,_.Partial,_.Group,_.Unknown,_.Advert];var ai;(function(n){n.Singleton="Singleton",n.ApplicationHost="ApplicationHost",n.DataSource="DataSource"})(ai||(ai={}));var ci="triptease.onboard.kernel";var $=class{static get(){return p(()=>{let e="6641.78397";return e?"v"+e:"latest"})}};var lr=class{static application(e){let r=ii();return{name:ci,url:`https://onboard.triptease.io/kernel/${$.get()}/kernel-host.html?originHost=${e}${r?"&"+r:""}`,type:"iframe",startMessage:"triptease.onboard.kernel-host-started",enabled:!0}}};var Us=H.getProperty("Date"),dr=class{now(){return new Us}},we=class{now(){return new Date}};function li(t){return new Promise(e=>{this.setTimeout(()=>{e()},t)})}var B=class{constructor(e=new we){this.clock=e;this.delay=li.bind(this);this.delay=li}task(e){return u(this,null,function*(){return yield this.delay(0),e()})}setTimeout(e,r){return setTimeout(e,r)}clearTimeout(e){clearTimeout(e)}setInterval(e,r){return setInterval(e,r)}clearInterval(e){clearInterval(e)}requestIdleCallback(e,r){let n=r?r.timeout:1,i=this.clock.now().getTime()+n,s=this;return this.setTimeout(()=>{e({didTimeout:!1,timeRemaining(){return Math.max(0,50-(s.clock.now().getTime()-i))}})},n)}cancelIdleCallback(e){this.clearTimeout(e)}};var Jc=new B;function di(t,e,r=new B){return n=>u(this,null,function*(){let i=yield Promise.race([e(n),r.delay(t)]);return i||{status:504,statusDescription:"Client timeout",body:`Request to ${n.url} timeout after ${t}`}})}function fe(t={credentials:!1}){return e=>u(this,null,function*(){if(typeof fetch!="undefined"){let r=yield fetch(e.url,{method:e.method,headers:e.headers,body:e.body,credentials:t.credentials?"include":"omit"});return{status:r.status,statusDescription:r.statusText,body:yield r.text()}}else{let r=new XMLHttpRequest;return r.open(e.method,e.url,!0),e.headers&&Object.keys(e.headers).forEach(n=>{r.setRequestHeader(n,e.headers[n])}),r.withCredentials=t.credentials,r.send(e.body),new Promise((n,i)=>{r.addEventListener("load",s=>{n({status:r.status,statusDescription:r.statusText,body:r.responseText})}),r.addEventListener("error",s=>{i(s)})})}})}var fi=R(pe());function _s(t){return t&&typeof t=="object"&&typeof t.name=="string"&&typeof t.type=="string"&&typeof t.enabled=="boolean"}function ui(t){return _s(t)&&t.type!=="other"&&typeof t.url=="string"}var Gs=/\${([^}]+)}/g;function pi(t,e){return Nn(Gs,t,([,r])=>{var n;return(n=e[r])!=null?n:`\${${r}}`})}var mi=class{constructor(e,r=fe()){this.logger=e;this.httpHandler=r;this.workers={}}createWorker(e,r){return u(this,null,function*(){let n=this.workers[e];return n||(this.workers[e]=yield this.create(r,{name:e}))})}create(e,r){return u(this,null,function*(){try{return new Worker(e,r)}catch(n){this.logger.debug("Failed to create Worker switching to Blob Worker because:",n.message);let i=`location.originalHref = "${e}";
`,a=(yield this.httpHandler({method:"GET",url:e})).body,c=new Blob([i,a],{type:"application/javascript"});return new Worker(URL.createObjectURL(c),r)}})}},at=class{constructor(e,r=b("application-starter"),n=new mi(r),i=new gi(e,r)){this.window=e;this.logging=r;this.workerFactory=n;this.waiter=i}start(e){return u(this,null,function*(){this.logging.debug(`ApplicationStarter starting app "${e.name}" (${e.type}), ${e.url}`);let r=this.window.document;if(e.type==="worker"){let s=yield this.workerFactory.createWorker(e.name,e.url);return e.startMessage&&(yield this.waiter.waitForMessage(e.startMessage,s)),this.logging.debug("ApplicationStarter returning worker"),s}let n=r.createElement(e.type);n.setAttribute("name",e.name),n.src=pi(e.url,{onboard_version:$.get()});let i=at.DefaultOptions[e.type]||{};return Object.keys(i).forEach(s=>{n.setAttribute(s.toLowerCase(),i[s])}),this.addElement(n),e.startMessage?yield this.waiter.waitForMessage(e.startMessage):e.type==="script"&&(yield this.waiter.waitForLoadEvent(n)),n})}addElement(e){(this.window.document.body||this.window.document.documentElement).appendChild(e)}static create(e){var n;let r=k(e).triptease.onboard;return r.applicationStarter=(n=r.applicationStarter)!=null?n:new at(e)}},re=at;re.DefaultOptions={script:{defer:"",async:"",crossOrigin:"anonymous"},iframe:{style:"display: none;",sandbox:"allow-scripts allow-same-origin",title:"blank","aria-hidden":"true"}},C([fi.cache],re.prototype,"start",1);var gi=class{constructor(e,r){this.window=e;this.logging=r}waitForLoadEvent(e){return this.logging.debug("MessageWaiter waiting for load/error event for",e),new Promise((r,n)=>{e.addEventListener("load",r),e.addEventListener("error",i=>n({name:"ScriptError",message:i.message||`Failed to load script "${e.src}"`}))})}waitForMessage(e,r=this.window){return this.logging.debug("MessageWaiter waiting for message",e),new Promise(n=>{this.logging.debug("MessageWaiter creating handler");let i=s=>{try{let a=s.data&&s.data.type,c=a===e;this.logging.debug(`ApplicationStarter message received "${a}", expecting "${e}", matched: ${c}`),c&&(r.removeEventListener("message",i),n(s.data))}catch(a){this.logging.debug("ApplicationStarter error in parsing message",a,s)}};this.logging.debug("MessageWaiter adding listener"),r.addEventListener("message",i)})}};var ct,Fs=new Uint8Array(16);function ur(){if(!ct&&(ct=typeof crypto!="undefined"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||typeof msCrypto!="undefined"&&typeof msCrypto.getRandomValues=="function"&&msCrypto.getRandomValues.bind(msCrypto),!ct))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return ct(Fs)}var yi=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function Ws(t){return typeof t=="string"&&yi.test(t)}var hi=Ws;var P=[];for(lt=0;lt<256;++lt)P.push((lt+256).toString(16).substr(1));var lt;function Ks(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=(P[t[e+0]]+P[t[e+1]]+P[t[e+2]]+P[t[e+3]]+"-"+P[t[e+4]]+P[t[e+5]]+"-"+P[t[e+6]]+P[t[e+7]]+"-"+P[t[e+8]]+P[t[e+9]]+"-"+P[t[e+10]]+P[t[e+11]]+P[t[e+12]]+P[t[e+13]]+P[t[e+14]]+P[t[e+15]]).toLowerCase();if(!hi(r))throw TypeError("Stringified UUID is invalid");return r}var bi=Ks;function zs(t,e,r){t=t||{};var n=t.random||(t.rng||ur)();if(n[6]=n[6]&15|64,n[8]=n[8]&63|128,e){r=r||0;for(var i=0;i<16;++i)e[r+i]=n[i];return e}return bi(n)}var pr=zs;var Se=()=>p(()=>crypto.randomUUID())||pr(),fr=class{generate(e){if(typeof e!="undefined")throw new Error("UuidGenerator does not support custom lengths");return Se().replace(/-/g,"")}};var vi=class{constructor(e,r){this.messaging=e;this.idGenerator=r}get(e,r,n){return(...i)=>u(this,null,function*(){let s=this.idGenerator.generate(),{payload:a}=yield this.messaging.handle({type:"triptease.onboard.request",requestType:String(r),payload:i,correlationId:s});if(xe(a))throw a;return a})}};function ne(t,e=new fr){return new Proxy({},new vi(t,e))}var mr=class{constructor(e,r=ne(e)){this.proxy=r;this.applicationConfig=ar(e=>u(this,null,function*(){return yield this.proxy.applicationConfig(e)}));this.generateConfig=ar(e=>u(this,null,function*(){return yield this.proxy.generateConfig(e)}))}};var ke=class{constructor(){this.scripts=[]}static create(e){let r=k(e).onboard,n=r.stackScriptFinder;return n||(r.stackScriptFinder=new ke)}capture(){let e=Ns();!e||this.scripts.push(e)}get(){return this.scripts}},Vs=/(https?.*):\d+:\d+/;function Ns(){try{throw new Error}catch(t){if(!t.stack)return;let e=t.stack.match(Vs);if(!e)return;let r=e[1];return new S(r)}}function xi({method:t="POST",url:e,body:r}){let n=D.stringify(r);if(typeof navigator.sendBeacon!="undefined"&&t==="POST")navigator.sendBeacon(e,n);else if(typeof fetch!="undefined")fetch(e,{method:t,body:n});else if(XMLHttpRequest){let i=new XMLHttpRequest;i.open(t,e,!0),i.send(n)}}var wi={name:"onboard",version:$.get()},$s="https://onboard.triptease.io";var gr=class{constructor(e,r,n=b("analytics"),i=50){this.window=e;this.clock=r;this.logger=n;this.batchSize=i;this.queued=[];setInterval(()=>u(this,null,function*(){return yield this.flush()}),1e3),this.window.addEventListener("pagehide",()=>u(this,null,function*(){return yield this.flush()}))}send(e){return u(this,null,function*(){this.queued.push(Js(this.clock,e)),this.queued.length>this.batchSize&&(yield this.flush())})}flush(){return u(this,null,function*(){if(this.queued.length===0)return;let e=this.queued.splice(0,this.batchSize);this.logger.log(`Flushing batch of ${e.length}, remaining in queue ${this.queued.length}`);let r={type:"triptease.onboard.batch",sentAt:this.clock.now(),payload:e};xi({url:`${$s}/message/batch`,body:r})})}};function Js(t,e){return A({messageId:Se(),createdAt:t.now()},e)}var Pi=R(be());function Ys(t){return t&&typeof t=="function"&&typeof t.getAll=="function"}function Si(n,i){return u(this,arguments,function*(t,e,r=new B){let s=t[t.GoogleAnalyticsObject||"ga"];return Ys(s)?ee(()=>u(this,null,function*(){let a=new Promise(c=>s(()=>c(T.unique(s.getAll().map(d=>d.get(e))))));return yield Promise.race([a,r.delay(50).then(()=>[])])})):[]})}function ki(t){return u(this,null,function*(){return{trackingIds:yield Si(t,"trackingId"),clientIds:yield Si(t,"clientId")}})}function Ai(t){return{containerIds:T.unique(Array.from(t.document.querySelectorAll("script[src*=googletagmanager]")).map(r=>{let{query:n}=new S(r.src),{id:i}=U(n);return i}))}}function Oi(t){let e=Object.fromEntries(t.document.cookie.split(";").map(r=>r.split("=").map(n=>n.trim())));return y.removeEmpty({fbp:e._fbp,fbc:e._fbc})}function Ci(t){return{appId:p(()=>t.duetto.initialConfig.appId),tld:p(()=>t.duetto.initialConfig.tld)}}function Ti(t){var n;let e=!!t.document.querySelector("script[src*=revinate], .revinate-form, #revinate_contact_api_form"),r=(n=t.document.querySelector("#revinate_contact_api_form"))==null?void 0:n.getAttribute("token");return{exists:e,contactApiFormToken:r}}function Ei(t){return u(this,null,function*(){return y.removeEmpty({googleAnalytics:yield ee(()=>ki(t),{}),googleTagManager:p(()=>Ai(t),{}),facebook:p(()=>Oi(t),{}),duetto:Ci(t),revinate:Ti(t)})})}function Zs(t){return{title:t.document.title,locale:t.document.documentElement.lang||t.document.documentElement.getAttribute("xml:lang")||"",url:t.location.href,urlParsed:Ae(t.location.href),referrer:t.document.referrer,referrerParsed:Ae(t.document.referrer),characterSet:t.document.characterSet,opener:p(()=>Boolean(t.opener),!1)}}function Ae(t){if(!t)return{};let{scheme:e,host:r,path:n,query:i,fragment:s}=new S(t);return y.removeEmpty({scheme:e,host:r,path:n,query:i,queryParsed:U(i,!1),fragment:s})}var yr=class{constructor(e,r,n){this.browserMessageBuilder=e;this.sessionTracker=r;this.identityCombiner=n}buildMessage(e){return u(this,null,function*(){var c;let r=yield this.browserMessageBuilder.buildMessage(e),n=yield this.identityCombiner.getIdentity(),s=(yield this.sessionTracker.urls((c=r.payload)==null?void 0:c.apiKey,n.serverTime)).map(d=>y.removeEmpty(G(A({},d),{wellKnownParams:ma(d.url)}))),a=pa(r.context.page);return O.merge(G(A({},y.removeEmpty(G(A({},n),{serverTime:void 0}))),{context:{page:{urls:s},tab:{history:s,wellKnownParams:ga(s.map(d=>d.wellKnownParams)),trafficSource:a},trafficSource:a}}),r)})}},dt=class{constructor(e,r=new we){this.window=e;this.clock=r}get timezone(){return p(()=>Intl.DateTimeFormat().resolvedOptions().timeZone,"")}buildMessage(e){return u(this,null,function*(){let r=this.clock.now(),n=Zs(this.window);return O.merge(y.removeEmpty({createdAt:r,messageId:Se(),context:{library:wi,userAgent:this.window.navigator.userAgent,locale:this.window.navigator.language,page:n,screen:{width:this.window.screen.width,height:this.window.screen.height},timezone:this.timezone,thirdParty:yield Ei(this.window),features:Qn(this.window,...Qs),performance:p(()=>PerformanceObserver.supportedEntryTypes,[])}}),e)})}};C([Pi.lazy],dt.prototype,"timezone",1);var Qs=["fbq","fetch","Set","Map","WebAssembly.constructor","PerformanceObserver","Date","Date.now","Date.prototype.toISOString","Date.prototype.toJSON","Date.prototype.getTime","crypto.randomUUID","crypto.getRandomValues","crypto.subtle.digest","Intl.Collator","Intl.NumberFormat","Intl.NumberFormat.prototype.formatToParts","Intl.DateTimeFormat","Intl.DateTimeFormat.prototype.formatToParts","console.log","navigator.share","navigator.serviceWorker","EventSource","customElements","__tcfapi","__cmp"];function ie(t,e){let r=p(()=>{var n;return(n=t.urlParsed)==null?void 0:n.queryParsed[e]})||p(()=>{var n;return(n=t.referrerParsed)==null?void 0:n.queryParsed[e]})||"";return p(()=>r.toLowerCase().trim())}var Xs=/^(.*cp.*|ppc|paid.*)$/,ea=/^social[-_ ]?(?:network|media)?$/,ta=new Set(["display","banner","expandable","interstitial","cpm"]);function ra(t){let e=ia.get(ie(t,"utm_source"));if(e)return e;let[r="Unknown"]=p(()=>t.referrerParsed.host.split(".").flatMap(n=>[na.get(n)].filter(Boolean)),[]);return r}var na=new Map([["facebook","Facebook"],["instagram","Instagram"],["twitter","Twitter"],["snapchat","SnapChat"]]),ia=new Map([["facebook","Facebook"],["facebook.com","Facebook"],["fb","Facebook"],["ig","Instagram"],["instagram","Instagram"],["line","Line"],["linkedin","LinkedIn"],["pinterest","Pinterest"],["reddit","Reddit"],["snapchat","SnapChat"],["tiktok","TikTok"],["tripadvisor","TripAdvisor"],["tripadvisor.com","TripAdvisor"],["twitter","Twitter"],["twitter.com","Twitter"],["wechat","WeChat"],["yelp","Yelp"],["zalo","Zalo"]]);function oa(t){return ea.test(ie(t,"utm_medium"))}function Ii(t){return Xs.test(ie(t,"utm_medium"))}function sa(t,e){if(e!=="Unknown")return Ii(t)?"Paid Search":"Organic Search"}function aa(t,e){if(e!=="Unknown")return Ii(t)?"Paid Social":"Organic Social";if(oa(t))return"Organic Social"}var ca=new Map([["baidu","Baidu"],["bing","Bing"],["duckduckgo","DuckDuckGo"],["google","Google"],["google.com","Google"],["googlemybusiness","Google"],["msn","MSN"],["naver","Naver"],["rakuten","Rakuten"],["seznam","Seznam"],["yahoo","Yahoo"],["yandex","Yandex"]]);function la(t){return ca.get(ie(t,"utm_source"))||"Unknown"}function da(t){let e=ie(t,"utm_source");if(e==="direct"||!ie(t,"utm_medium")&&!e)return"Direct"}function ua(t){if(ta.has(ie(t,"utm_medium")))return"Display"}function pa(t){let e=ra(t),r=la(t);return{channel:da(t)||sa(t,r)||aa(t,e)||ua(t)||"Unknown",social:e,searchEngine:r}}var fa=["utm_campaign","utm_content","utm_medium","utm_source","utm_term","tt_ad_type","tt_channel","tt_meta","tt_pmd","tt_ps_tid","tt_rt","dclid","fbclid","gbraid ","gclid","gclsrc","msclkid","wbraid"];function ma(t){if(typeof t!="string")return{};let{queryParsed:e}=Ae(t);return y.removeEmpty(fa.reduce((r,n)=>{let i=e==null?void 0:e[n];return r[n]=Array.isArray(i)?i.filter(Boolean)[0]:i,r},{}))}function ga(t){return t.filter(Boolean).reverse().reduce((r,n)=>O.merge(r,n),{})}var Ri="triptease.onboard.response";function hr(t){return t&&typeof t=="object"&&t.type==="triptease.onboard.request"&&typeof t.requestType=="string"&&typeof t.correlationId=="string"&&Array.isArray(t.payload)}function ut(t){return t&&typeof t=="object"&&t.type==="triptease.onboard.response"&&typeof t.correlationId=="string"}function pt(t,e){return{type:"triptease.onboard.response",correlationId:t,payload:e}}function ft(t,e){return pt(t,cr("NotFound","No handler found for "+e))}function Li(t){return p(()=>t.payload.name==="NotFound",!1)}function Hi(t,e){return pt(t,cr(e.name,e.message,e.stack))}var ya=b("messaging"),br=class{constructor(){this.handlers=new Map}register(e,r){return e.forEach(n=>{if(this.hasHandlerFor(n))throw new Error(`Method name "${n}" already registered to a handler`);this.handlers.set(n,r)}),this}handle(e){return u(this,null,function*(){let r=this.handlers.get(e.requestType);return r?(ya.debug("Matched message to handler",e,r),yield r.handle(e)):ft(e.correlationId,e.requestType)})}hasHandlerFor(e){return this.handlers.has(e)}};var vr=b("messaging"),Oe=class{constructor(e){this.target=e}handle(e){return u(this,null,function*(){let r=this.target[e.requestType];if(!r)return vr.debug("No method found that matches method",e.requestType,this.target),ft(e.correlationId,e.requestType);try{vr.debug("Found method",e.requestType);let n=yield r.apply(this.target,e.payload);return pt(e.correlationId,n)}catch(n){return vr.debug("Error trying to in invoke method",e.requestType,n),Hi(e.correlationId,n)}})}};var ha=$.get();function ba(t){return`https://onboard.triptease.io/integrations/${ha}/${t}.js`}function xr(t){return t.replace(/-/g,"").toLowerCase()}var l=class{constructor(e){this.name=e;if(!/[A-Za-z0-9]/.test(e))throw new Error("Only alpha numeric allowed");l.Lookup.set(xr(e),this)}static values(){return Array.from(l.Lookup.values())}static parse(e){let r=l.Lookup.get(xr(e));if(!r)throw new Error(`Invalid booking engine name: ${e}`);return r}toString(){return this.name}get canonical(){return xr(this.name)}get folder(){return this.isSelfIntegration()?l.Default.folder:this.isSelfIntegrationStrict()?l.DefaultStrict.folder:q.kebabCase(this.name)}get script(){return ba(this.folder)}isSelfIntegration(){return l.SelfIntegration.has(this)}isSelfIntegrationStrict(){return l.SelfIntegrationStrict.has(this)}},o=l;o.Lookup=new Map,o.AboveProperty=new l("AboveProperty"),o.AfricaAlbida=new l("AfricaAlbida"),o.Alaric=new l("Alaric"),o.ARHotels=new l("ARHotels"),o.Ascott=new l("Ascott"),o.ASIWebRes=new l("ASIWebRes"),o.Auberge=new l("Auberge"),o.AvailPro=new l("AvailPro"),o.Avvio=new l("Avvio"),o.Ayana=new l("Ayana"),o.AZDS=new l("AZDS"),o.Azimut=new l("Azimut"),o.BestWesternFrance=new l("BestWesternFrance"),o.BestWesternItaly=new l("BestWesternItaly"),o.BestWesternUk=new l("BestWesternUk"),o.Bloom=new l("Bloom"),o.Bode=new l("Bode"),o.BookAssist=new l("BookAssist"),o.BookEasy=new l("BookEasy"),o.BookOnlineNow=new l("BookOnlineNow"),o.BookVisit=new l("BookVisit"),o.Booking=new l("Booking"),o.Booking2Hotels=new l("Booking2Hotels"),o.BookingExpert=new l("BookingExpert"),o.BrochnerHotels=new l("BrochnerHotels"),o.BusyRooms=new l("BusyRooms"),o.BWHHotelGroup=new l("BWHHotelGroup"),o.CapoBay=new l("CapoBay"),o.CityExpress=new l("CityExpress"),o.ClaytonHotel=new l("ClaytonHotel"),o.Clock=new l("Clock"),o.CloudBeds=new l("CloudBeds"),o.Cocotel=new l("Cocotel"),o.CompuRez=new l("CompuRez"),o.Comwell=new l("Comwell"),o.ConstanceHotels=new l("ConstanceHotels"),o.Default=new l("Default"),o.DefaultStrict=new l("DefaultStrict"),o.DerqueBooking=new l("DerqueBooking"),o.DeutscheHospitality=new l("DeutscheHospitality"),o.DoyleCollection=new l("DoyleCollection"),o.EasyBooking=new l("EasyBooking"),o.EasyConsulting=new l("EasyConsulting"),o.Erez=new l("Erez"),o.EGds=new l("EGds"),o.Evancy=new l("Evancy"),o.Everly=new l("Everly"),o.ExtendedStayAmerica=new l("ExtendedStayAmerica"),o.Ezee=new l("Ezee"),o.FastBooking=new l("FastBooking"),o.Firmdale=new l("Firmdale"),o.FourSeasons=new l("FourSeasons"),o.FrontDeskMaster=new l("FrontDeskMaster"),o.Furama=new l("Furama"),o.Generic=new l("Generic"),o.GlenEagles=new l("GlenEagles"),o.GothiaTowers=new l("GothiaTowers"),o.GuestCentric=new l("GuestCentric"),o.GuestDesk=new l("GuestDesk"),o.GuestLine=new l("GuestLine"),o.GuestPro=new l("GuestPro"),o.Guild=new l("Guild"),o.HamiltonIsland=new l("HamiltonIsland"),o.HamiltonIslandHolidayHomes=new l("HamiltonIslandHolidayHomes"),o.HandPickedHotels=new l("HandPickedHotels"),o.Hart=new l("Hart"),o.HHotels=new l("HHotels"),o.HighLevelSoftware=new l("HighLevelSoftware"),o.Hipotels=new l("Hipotels"),o.Hoteliers=new l("Hoteliers"),o.HoteliersGuru=new l("HoteliersGuru"),o.HotelNetSolutions=new l("HotelNetSolutions"),o.Hotetec=new l("Hotetec"),o.Hotusa=new l("Hotusa"),o.Hoxton=new l("Hoxton"),o.HtiSystems=new l("HtiSystems"),o.Hyatt=new l("Hyatt"),o.GHS=new l("GHS"),o.Iberostar=new l("Iberostar"),o.Infotera=new l("Infotera"),o.InnQuest=new l("InnQuest"),o.InnRoad=new l("InnRoad"),o.InnStyle=new l("InnStyle"),o.Iperbooking=new l("Iperbooking"),o.IRM=new l("IRM"),o.Kasa=new l("Kasa"),o.KeaHotels=new l("KeaHotels"),o.Kempinski=new l("Kempinski"),o.LHW=new l("LHW"),o.LifeHouse=new l("LifeHouse"),o.Loews=new l("Loews"),o.Lotte=new l("Lotte"),o.LotusGroup=new l("LotusGroup"),o.LumaHotels=new l("LumaHotels"),o.Mews=new l("Mews"),o.Mirai=new l("Mirai"),o.NativePlaces=new l("NativePlaces"),o.NeoBookings=new l("NeoBookings"),o.NHHotels=new l("NHHotels"),o.OKU=new l("OKU"),o.Omnibees=new l("Omnibees"),o.OneHotels=new l("OneHotels"),o.Opera=new l("Opera"),o.PalaceResorts=new l("PalaceResorts"),o.Paraty=new l("Paraty"),o.Pegasus=new l("Pegasus"),o.Pelican=new l("Pelican"),o.PointAHotels=new l("PointAHotels"),o.Prestige=new l("Prestige"),o.ProfitRoom=new l("ProfitRoom"),o.Protel=new l("Protel"),o.PursuitCollection=new l("PursuitCollection"),o.RedPlanet=new l("RedPlanet"),o.RegalHotels=new l("RegalHotels"),o.ReserveHotel=new l("ReserveHotel"),o.ReserveOnline=new l("ReserveOnline"),o.Reservit=new l("Reservit"),o.Reseze=new l("Reseze"),o.Retargeting=new l("Retargeting"),o.Reztrip=new l("Reztrip"),o.RGuest=new l("RGuest"),o.RMSCloud=new l("RMSCloud"),o.Roiback=new l("Roiback"),o.RoomKey=new l("RoomKey"),o.RoomMaster=new l("RoomMaster"),o.RoomStay=new l("RoomStay"),o.SandsVegas=new l("SandsVegas"),o.Sandrix=new l("Sandrix"),o.Sbe=new l("Sbe"),o.SeamillHydro=new l("SeamillHydro"),o.Seekda=new l("Seekda"),o.Shr=new l("Shr"),o.SimpleBooking=new l("SimpleBooking"),o.SiteMinder=new l("SiteMinder"),o.StationCasinos=new l("StationCasinos"),o.Stayntouch=new l("Stayntouch"),o.Synxis=new l("Synxis"),o.SysHotelOnline=new l("SysHotelOnline"),o.Taj=new l("Taj"),o.Travelanium=new l("Travelanium"),o.TravelClick=new l("TravelClick"),o.Uibscrs=new l("Uibscrs"),o.Up=new l("Up"),o.VacationMarbella=new l("VacationMarbella"),o.Valamar=new l("Valamar"),o.VerticalBooking=new l("VerticalBooking"),o.Viato=new l("Viato"),o.Vinpearl=new l("Vinpearl"),o.WebRezPro=new l("WebRezPro"),o.WestCordHotels=new l("WestCordHotels"),o.Youngs=new l("Youngs"),o.Zafiro=new l("Zafiro"),o.SelfIntegration=new Set([l.Avvio,l.ClaytonHotel,l.HtiSystems,l.LHW]),o.SelfIntegrationStrict=new Set([l.ExtendedStayAmerica]);function Ce(t,...e){let r=nt(t,...e);if(!r)return;let[n]=[...r].reverse();return n}function wr(t){let e=p(()=>t.host.toLowerCase(),""),r=t.toString().toLowerCase();if(e==="gc.synxis.com")return o.Synxis;if(e==="be.synxis.com")return o.Synxis;if(e.indexOf("travelclick")!==-1)return o.TravelClick;if(e.indexOf("bookingbutton")!==-1||e.indexOf("book-directonline")!==-1||e.indexOf("direct-book.com")!==-1)return o.SiteMinder;if(e.indexOf(".hyatt.")!==-1)return o.Hyatt;if(e.indexOf(".bookonthenet.")!==-1)return o.RoomKey;if(e.indexOf("firmdalehotels")!==-1)return o.Firmdale;if(e.indexOf("apxhotelsapartments")!==-1||e.indexOf("mews.li")!==-1)return o.Mews;if(e.indexOf("guestline.net")!==-1||e.indexOf("roomlynx.net")!==-1)return o.GuestLine;if(e.indexOf("book-onlinenow.net")!==-1)return o.BookOnlineNow;if(e.indexOf("windsurfercrs.com")!==-1)return o.Shr;if(e.indexOf("bestwestern.fr")!==-1)return o.BestWesternFrance;if(r.indexOf("webrez.com")!==-1||e.indexOf("worldweb.com")!==-1||e.indexOf("webrez.com/v")!==-1)return o.WebRezPro;if(e.indexOf("hoteliers.com")!==-1)return o.Hoteliers;if(e.indexOf("doylecollection")!==-1)return o.DoyleCollection;if(r.indexOf("/bookcore/")!==-1)return o.Roiback;if(e.indexOf("nativeplaces.com")!==-1)return o.NativePlaces;if(r.indexOf("/cgi-bin/lansaweb")!==-1)return o.StationCasinos;if(e==="www.palms.com")return o.StationCasinos;if(e.indexOf(".webhotel.")!==-1)return o.Opera;if(e.indexOf("constancehotels.com")!==-1)return o.ConstanceHotels;if(e.indexOf("online.bookvisit.")!==-1)return o.BookVisit;if(e.indexOf("direct-reservation")!==-1)return o.BusyRooms;if(e.indexOf("youngshotels")!==-1)return o.Youngs;if(e.indexOf("loewshotels")!==-1)return o.Loews;if(r.indexOf("bookings.hamiltonisland.com.au/")!==-1)return o.HamiltonIsland;if(e.indexOf("regalhotel")!==-1)return o.RegalHotels;if(e.indexOf("live.high-level-software")!==-1)return o.HighLevelSoftware;if(e.indexOf("premiereserve.com")!==-1||e.indexOf("teg-hotels.com")!==-1)return o.Everly;if(e.indexOf("simplebooking")!==-1||e.indexOf("booking.crimsonhotel")!==-1)return o.SimpleBooking;if(e.indexOf("bookassist.com")!==-1)return o.BookAssist;if(e.indexOf("booking.africaalbidatourism.com")!==-1)return o.AfricaAlbida;if(e.indexOf("onepagebooking.com")!==-1)return o.HotelNetSolutions;if(e.indexOf("reservhotel.com")!==-1)return o.ReserveHotel;if(r.indexOf("/irmng")!==-1)return o.IRM;if(e.indexOf("booking-channel.com")!==-1)return o.Hotusa;if(e.includes(".venetian.")||e.includes(".venetianlasvegas."))return o.SandsVegas;if(e.indexOf("clock-software.com")!==-1||e.indexOf("villasriomar.com")!==-1)return o.Clock;if(e.indexOf("tajinnercircle.com")!==-1||e.indexOf("tajhotels.com")!==-1)return o.Taj;if(e.indexOf("booking.iberostartheclub.com")!==-1)return o.Iberostar;if(e.indexOf("services.comwell.com")!==-1)return o.Comwell;if(e.indexOf(".profitroom.")!==-1)return o.ProfitRoom;if(e.indexOf("bookingexpert.it")!==-1)return o.BookingExpert;if(e.indexOf("cloud-reservations.net")!==-1)return o.Hart;if(e.indexOf("pr.palaceresorts.com")!==-1||e.indexOf("pr.moonpalace.com")!==-1||e.indexOf("pr.leblancsparesorts.com")!==-1||e.indexOf(".palaceelite.com")!==-1)return o.PalaceResorts;if(e.indexOf(".iqwebbook.com")!==-1)return o.InnQuest;if(e.indexOf("theguild.co")!==-1)return o.Guild;if(e.indexOf(".innroad.com")!==-1)return o.InnRoad;if(e.indexOf(".furama.com")!==-1)return o.Furama;if(e.indexOf(".reztrip.com")!==-1)return o.Reztrip;if(e.indexOf("nisekoportfolio.com")!==-1)return o.BookEasy;if(e.indexOf("azimuthotels")!==-1&&e.indexOf("reservations")===-1)return o.Azimut;if(e.indexOf(".steigenberger.com")!==-1||e.indexOf(".intercityhotel.com")!==-1||e.indexOf(".maxxhotel.com")!==-1||e.indexOf(".jaz-hotel.com")!==-1)return o.DeutscheHospitality;if(e.indexOf(".cloudbeds.com")!==-1)return o.CloudBeds;if(e.indexOf(".thehoxton.com")!==-1)return o.Hoxton;if(e.indexOf(".lottehotel.com")!==-1)return o.Lotte;if(e.indexOf("kempinski.com")!==-1)return o.Kempinski;if(e.indexOf("derquebooking")!==-1)return o.DerqueBooking;if(e.indexOf(".gfhoteles.")!==-1)return o.DerqueBooking;if(e.indexOf(".gleneagles.com")!==-1)return o.GlenEagles;if(e.indexOf(".redplanethotels.com")!==-1)return o.RedPlanet;if(e.indexOf(".banffjaspercollection.com")!==-1||e.indexOf(".glacierparkcollection.com")!==-1)return o.PursuitCollection;if(e.indexOf(".bestwestern.co.uk")!==-1)return o.BestWesternUk;if(e.indexOf(".sbe.com")!==-1)return o.Sbe;if(e.indexOf(".reserve-online.net")!==-1)return o.ReserveOnline;if(e.indexOf("secure-hotel-booking.com")!==-1)return o.AvailPro;if(e.indexOf(".syshotelonline.it")!==-1)return o.SysHotelOnline;if(e.indexOf(".reservit.com")!==-1)return o.Reservit;if(e.indexOf(".vinpearl.com")!==-1)return o.Vinpearl;if(e.indexOf(".omnibees.com")!==-1)return o.Omnibees;if(e.indexOf(".hipotels.com")!==-1)return o.Hipotels;if(e.indexOf(".handpickedhotels.co.uk")!==-1)return o.HandPickedHotels;if(e.indexOf("bookings.zafirohotels.com")!==-1)return o.Zafiro;if(e.indexOf(".viatocrs.de")!==-1)return o.Viato;if(e.indexOf(".easy-booking.")!==-1)return o.EasyBooking;if(e.indexOf(".ipms247.")!==-1||e.indexOf("reservas.hotelkokai.com")!==-1)return o.Ezee;if(e.indexOf(".innstyle.")!==-1)return o.InnStyle;if(e.indexOf(".book-secure.")!==-1)return o.FastBooking;if(e.indexOf(".cityexpress.")!==-1)return o.CityExpress;if(e.indexOf(".hoteleasyreservations.")!==-1)return o.EasyConsulting;if(e.indexOf(".travelanium.")!==-1)return o.Travelanium;if(e.indexOf(".e-gds.")!==-1)return o.EGds;if(e.indexOf(".booking.com")!==-1)return o.Booking;if(e.indexOf(".iperbooking.")!==-1)return o.Iperbooking;if(e.indexOf(".okuhotels.")!==-1)return o.OKU;if(e.indexOf(".pegsbe.")!==-1)return o.Pegasus;if(e.indexOf(".the-ascott.")!==-1||e.indexOf(".discoverasr.")!==-1)return o.Ascott;if(e.indexOf("kasa.")!==-1)return o.Kasa;if(e.indexOf("aubergeresorts.")!==-1&&e.indexOf("reserve.aubergeresorts.")===-1)return o.Auberge;if(e.indexOf("verticalbooking.")!==-1)return o.VerticalBooking;if(e.indexOf(".avvio.")!==-1)return o.Avvio;if(e.indexOf(".bestwestern.it")!==-1)return o.BestWesternItaly;if(e.indexOf("bookings.claytonhotel")!==-1)return o.ClaytonHotel;if(e.indexOf("extendedstayamerica.")!==-1)return o.ExtendedStayAmerica;if(e.indexOf(".fourseasons.")!==-1||e.indexOf(".fourseasonscountryclub.")!==-1||e.indexOf(".fsweb.")!==-1)return o.FourSeasons;if(e.indexOf(".hti-systems.")!==-1)return o.HtiSystems;if(e.indexOf("lhw.")!==-1)return o.LHW;if(e.indexOf("nh-hotels.")!==-1||e.indexOf(".nh-hoteles.")!==-1||e.indexOf("nh-collection.")!==-1)return o.NHHotels;if(e.indexOf(".h-hotels.")!==-1)return o.HHotels;if(e.indexOf(".gothiatowers.")!==-1||e.indexOf(".upperhouse.")!==-1)return o.GothiaTowers;if(e.indexOf(".1hotels.")!==-1)return o.OneHotels;if(e.indexOf(".asiwebres.")!==-1)return o.ASIWebRes;if(e.indexOf(".bwhhotelgroup.")!==-1)return o.BWHHotelGroup;if(e.indexOf(".frontdeskmaster.")!==-1)return o.FrontDeskMaster;if(e.indexOf(".evancy.")!==-1)return o.Evancy;if(e.indexOf(".brochner-hotels.")!==-1)return o.BrochnerHotels;if(e.indexOf(".welcome-anywhere.")!==-1)return o.RoomMaster;if(e.indexOf("staybloom.")!==-1)return o.Bloom;if(e.indexOf(".keahotels.")!==-1)return o.KeaHotels;if(e.indexOf("westcordhotels.")!==-1)return o.WestCordHotels;if(e.indexOf(".lumahotels.")!==-1)return o.LumaHotels;if(e.indexOf(".reservation-system.")!==-1||e.indexOf(".allhandsmarketing.")!==-1)return o.Pelican;if(e.indexOf(".pointahotels.")!==-1)return o.PointAHotels;if(e.indexOf(".capobay.")!==-1)return o.CapoBay;if(e.indexOf("lotusdesaru.")!==-1||e.indexOf("lotusseaview.")!==-1)return o.LotusGroup;if(e.indexOf(".hamiltonislandholidayhomes.")!==-1)return o.HamiltonIslandHolidayHomes;if(e.indexOf(".hoteliers.guru")!==-1)return o.HoteliersGuru;if(e.indexOf(".reseze.")!==-1)return o.Reseze;if(e.indexOf(".aboveproperty.")!==-1)return o.AboveProperty;if(e.indexOf(".seamillhydro.")!==-1)return o.SeamillHydro;if(e.indexOf(".superghs.")!==-1)return o.GHS;if(e.indexOf(".rguest.")!==-1)return o.RGuest;if(e.indexOf(".ayana.")!==-1)return o.Ayana;if(e.indexOf("erez.")!==-1)return o.Erez;if(e.indexOf(".valamar.")!==-1)return o.Valamar;if(e.indexOf(".stayntouch.")!==-1)return o.Stayntouch;if(e.indexOf("honeycomb.rt.triptease.io")!==-1||e.indexOf("b.triptease.io")!==-1)return o.Retargeting}function va(t){if(t.document.querySelector('link[href*="synxis.com"]'))return o.Synxis;if(p(()=>Object.values(t.process.env).some(e=>p(()=>String(e).includes("synxis")))))return o.Synxis;if(p(()=>Object.keys(t).filter(r=>r.endsWith("Url")).map(r=>t[r]).some(r=>String(r).includes("travelclick.com")))||p(()=>!!Ce(t.dataLayer,"ihHotelID"),!1))return o.TravelClick;if(p(()=>t.document.querySelector('link[href*="vendors~about~booking~cancellation~checkout~confirmation~contact~policies~reservation"]'))||p(()=>Ce(t.dataLayer,"booking_engine")==="Modern")||p(()=>Ce(t.dataLayer,"tbb_prefix"))||p(()=>Ce(t.dataLayer,"virtual_url"))||p(()=>t.document.querySelector('meta[name="occupancy-includes-infants"]'))||p(()=>!!t.digitalPartner.triptease))return o.SiteMinder;if(p(()=>t.dataLayer.some(e=>e.neobookings),!1))return o.NeoBookings;if(p(()=>Ce(t.dataLayer,"context.application")==="smart",!1))return o.AvailPro;if(t.document.querySelector('iframe.mews-distributor, script[src*="mews.li"]'))return o.Mews;if(t.WSMAIN||t.WsVars)return o.Shr;if(p(()=>t.document.querySelector("#clienId"),void 0))return o.RMSCloud;if(t.document.getElementById("bookingGadget")!==null)return o.GuestCentric;if(Boolean(t.document.querySelector('script[src*="UiBSJs"]')))return o.Uibscrs;if(p(()=>Boolean(t.Mirai),!1))return o.Mirai;if(t.MAIN_SITE==="paraty"||t.document.querySelector(".paraty-booking-form"))return o.Paraty;if(!!t.document.querySelector('[href^="https://www.booking2hotels.com"]')||t.document.querySelector('.booking-engine img[src*="booking2hotels"]'))return o.Booking2Hotels;if(t.document.querySelector('script[src*="seekda"]'))return o.Seekda;if(t.document.querySelector('meta[name="author"][content*="alaric"], [href*="alaric."]'))return o.Alaric;if(p(()=>t.top.location.hostname.toLowerCase().indexOf("hotel-llevant")!==-1,!1))return o.Prestige;if(p(()=>t.document.querySelector('meta[name="description"]').content.indexOf("reztrip")!==-1,!1))return o.Reztrip;if(p(()=>!!t.PROTELWBE5,!1))return o.Protel;if(p(()=>t.document.querySelector('link[href*="/bookvisit/"], meta[content*=".bookvisit."]')))return o.BookVisit;if(p(()=>t.document.querySelector('link[href*="webhotelier.net"]')))return o.ReserveOnline;if(p(()=>t.document.querySelector("#availpro-tracker")))return o.AvailPro;if(p(()=>t.document.querySelector("meta[name=Author][content*=RESERVIT]")))return o.Reservit;if(p(()=>t.document.querySelector("#eZee_BookingContainer, #eZee_BookingHeader, #eZee_BookingFilter, #eZ_BookingRooms")))return o.Ezee;if(p(()=>t.document.querySelector("img[src*=hotetec],a[href*=hotetec]")))return o.Hotetec;if(p(()=>t.document.querySelector("link[href*=cityexpress]")))return o.CityExpress;if(p(()=>t.document.querySelector("link[href*=travelanium]")))return o.Travelanium;if(p(()=>t.document.querySelector('a[href*=".e-gds."],img[src*=".e-gds."]')))return o.EGds;if(p(()=>t.document.querySelector('img[src*=".pegsbe."],img[src*=".bookingdirect."]')))return o.Pegasus;if(p(()=>t.document.querySelector("a[href*=verticalbooking], a[href*=VerticalBooking], script[src*=verticalbooking]")))return o.VerticalBooking;if(p(()=>t.document.querySelector("guestdesk")))return o.GuestDesk;if(t.document.querySelector("img[src*=booking-channel],div[style*=booking-channel]"))return o.Hotusa;if(t.document.querySelector('img[src*=".asiwebres."]'))return o.ASIWebRes;if(t.document.querySelector('[src*=".azds.com"],[href*=".azds.com"]'))return o.AZDS;if(t.document.querySelector('[href*="compurez"]')||p(()=>t.document.querySelector("#footer").textContent.includes("CompuRez")))return o.CompuRez;if(t.document.querySelector('img[src*=".roommaster."],div[style*=".roommaster."]'))return o.RoomMaster;if(t.document.querySelector("[ng-app=PelicanApp]")||p(()=>t.myApp.name)==="PelicanApp")return o.Pelican;if(t.document.querySelector('#avvio, [href*="avvio.com"], [src*="avvio.com"]'))return o.Avvio;if(t.document.querySelector('[src*=".shrglobal."],[href*=".shrglobal."]'))return o.Shr;if(t.document.querySelector('[href*=".infotera."]'))return o.Infotera;if(t.document.querySelector('img[src*=".hoteliers.guru"]'))return o.HoteliersGuru;if(p(()=>typeof t.iBooking.hotel_alias=="string"))return o.GHS;if(t.document.querySelector('[src*=".omnibees."]'))return o.Omnibees;if(t.document.querySelector('[src*=".roomstay."],[href*=".roomstay."],[id*=roomstay-],[name*=roomstay-]'))return o.RoomStay;if(t.document.querySelector('[src*=".guestpro."],[href*="guestpro."]'))return o.GuestPro;if(p(()=>t.BookingEngine.SiteSettings.ApiUri,"").includes(".frontdeskmaster."))return o.FrontDeskMaster;if(t.location.host.indexOf(".opalcollection.")!==-1)return o.Sandrix;if(t.document.querySelector("[id*=erez]"))return o.Erez;if(t.document.querySelector('ibe-up,[src*="ibe.uphotel.agency"]'))return o.Up;if(t.document.querySelector('[src*=".profitroom."]'))return o.ProfitRoom;if(p(()=>t.rt4Datalayer.ArrivalDtYYYYMMDD))return o.Pegasus;if(t.document.querySelector('img[src*="b.triptease.io/assets/adverts"]'))return o.Retargeting}function xa(t){let e=p(()=>new S(t.location.href).host.toLowerCase(),"");if(e.indexOf(".ar-hotels.")!==-1)return o.ARHotels;if(e.indexOf("vacationmarbella.")!==-1)return o.VacationMarbella;if(t.document.querySelector("[src*=life-house],[href*=life-house]"))return o.LifeHouse;if(e.indexOf("cocotel.")!==-1)return o.Cocotel;if(e.indexOf(".bode.co")!==-1||t.document.querySelector('link[rel="canonical"][href*="bode.co"]'))return o.Bode}function wa(t){let e=t.querySelector('script[src*="static.triptease.io/client-integrations/"]');if(!e)return;let[,r]=p(()=>e.src.match(/\/([^/]+).js$/))||[];if(!!r)return p(()=>o.parse(r))}function Sa(t){return p(()=>{let r=t.document.querySelector('script[src*="onboard.triptease.io/bootstrap.js"]').src.match(/fallback=([a-zA-Z]+)/)[1];return o.parse(r)})}function ka(t){let e=p(()=>new S(t.location.href).host.toLowerCase(),""),r=t.location.href.toString().toLowerCase();if(e.indexOf(".bachmann-hotels.")!==-1&&r.indexOf("confirmation")!==-1)return o.Protel;if(e.indexOf(".tradewindsresort.")!==-1)return o.DefaultStrict;if(e.indexOf(".comohotels.")!==-1)return o.DefaultStrict;if(e.indexOf(".banyantree.")!==-1)return o.DefaultStrict;if(e.indexOf(".peninsula.")!==-1)return o.DefaultStrict}function Mi(t){return p(()=>wr(new S(t.location.href)))||p(()=>va(t))||p(()=>xa(t))||wa(t.document)||Sa(t)||ka(t)||o.Default}var Di=b("messaging"),me=class{constructor(e){this.messageHandler=e;this.promises=new Map;e&&e.addListener(r=>{if(ut(r)){let{correlationId:n}=r,i=this.promises.get(n);i&&(Di.debug("Sender matched response",r),i.resolve(r),this.promises.delete(n))}})}handle(e){return u(this,null,function*(){return Di.debug("Sending request",e),this.messageHandler&&this.messageHandler.send(e),new Promise((r,n)=>{this.promises.set(e.correlationId,{resolve:r,reject:n})})})}};var Sr=class{constructor(e,r,n=b("messaging")){this.listen=e;this.router=r;this.logger=n;this.rules=[];e.addListener(this.handler.bind(this)),this.addRule(hr,i=>i,i=>i),this.addRule(Oa,Ta,Bi)}registerAlias(e,r){if(!this.router.hasHandlerFor(r))throw new Error(`Illegal alias: Method "${r}" is not registered with router`);return this.addRule(Aa(e),Ca(r),Bi)}handler(e,r){return u(this,null,function*(){if(ut(e))return;this.logger.debug("listenOn received request",e);let n=this.rules.find(a=>a.predicate(e));if(!n)return;let i=n.requestConverter(e),s=yield this.router.handle(i);if(Li(s)){this.logger.debug(`Handler not found for request "${i.requestType}", potentially for another listener`);return}e.correlationId&&e.correlationId===s.correlationId&&(this.logger.debug("listenOn sending response to sender",s),r.send(n.responseConverter(s)))})}addRule(e,r,n){return this.rules.push({predicate:e,requestConverter:r,responseConverter:n}),this}};function Aa(t){return e=>e.type===t}function Oa(t){return!hr(t)&&!!t.correlationId}function Ca(t){return e=>({type:"triptease.onboard.request",requestType:String(t),payload:[e],correlationId:e.correlationId||"fire-and-forget"})}function Ta(t){let{value:e,correlationId:r}=t,{method:n}=sr(t.type);return{type:"triptease.onboard.request",requestType:n,payload:[e],correlationId:r}}function Bi(t){return{type:"triptease.onboard.response",correlationId:t.correlationId,value:t.payload}}var Te=class{static find(e){return this.scripts(e).map(r=>new S(r.src))}static scripts(e){let n=["bootstrap.js","/paperboy/","/identity-service/confirm"].map(s=>`script[src*="${s}"][src*="triptease.io"]`);n.push('script[src*="triptease.net"]');let i=n.join(", ");return e.querySelectorAll(i)}};var mt=class{static difference(e,r){return Array.from(e).reduce((n,i)=>r.has(i)?n:n.add(i),new Set)}};var Z=b("events"),kr=class{constructor(e,r){this.timers=e;this.handle=r;this.finders=new Set;this.keepers=new Set;this.handleEvent=e=>u(this,null,function*(){try{Z.debug("CreatedOrDeletedEvents: Checking for new created items");let r=new Set(Array.from(this.finders).flatMap(s=>s()));Z.debug("CreatedOrDeletedEvents: found",r);let n=mt.difference(r,this.keepers);Z.debug("CreatedOrDeletedEvents: newItems",n);let i=mt.difference(this.keepers,r);Z.debug("CreatedOrDeletedEvents: deletedItems",i),this.keepers=r,(n.size>0||i.size>0)&&(Z.log(`CreatedOrDeletedEvents: ${n.size} created, ${i.size} deleted element detected - firing event`),yield this.handle(e))}catch(r){Z.error("CreatedOrDeletedEvents.handleEvent threw while polling",r)}})}start(){return u(this,null,function*(){Z.log("Start polling for created items"),this.id=this.timers.setInterval(this.handleEvent,1e3)})}stop(){return u(this,null,function*(){Z.log("Stop polling for created items"),this.id&&(this.timers.clearInterval(this.id),this.id=void 0)})}watch(e){e().forEach(n=>this.keepers.add(n)),this.finders.add(e)}};function ji(t,e){return()=>Array.from(t.querySelectorAll(e))}var Ea=b("events"),Ar=class{constructor(e,r){this.window=e;this.delegate=r;this.first=!0;this.fire=e=>u(this,null,function*(){if(this.window.document.hidden&&!this.first){Ea.log("Document hidden - skipping",e);return}yield this.delegate.fire(),this.first=!1})}listen(e){return u(this,null,function*(){yield this.delegate.listen(e)})}removeListener(e){this.delegate.removeListener(e)}};var Or=b("events"),Cr=class{constructor(e,r){this.delegate=e;this.running=r;this.fire=e=>u(this,null,function*(){if(this.running.value){Or.log("Already running - skipping",e);return}this.running.value=!0,yield this.delegate.fire(),this.running.value=!1})}listen(e){return u(this,null,function*(){if(yield this.delegate.listen(e),this.running.value){Or.log("Already running - firing immediately");try{yield e()}catch(r){Or.log(r)}}})}removeListener(e){this.delegate.removeListener(e)}};var qi=b("events"),Tr=class{constructor(){this.handlers=[];this.fire=e=>u(this,null,function*(){qi.log(`Firing handlers(${this.handlers.length})`,e),yield Promise.all(this.handlers.map(r=>u(this,null,function*(){try{yield r()}catch(n){qi.log("Error while firing handler",n)}})))})}listen(e){return u(this,null,function*(){this.handlers.push(e)})}removeListener(e){this.handlers=this.handlers.filter(r=>r!==e)}};var Ui=b("events"),Er=class{constructor(e,r){this.timers=e;this.delegate=r;this.timeoutMs=1e3;this.timerId=0;this.fire=e=>u(this,null,function*(){Ui.log(`Event observed, waiting for ${this.timeoutMs} ms quiet`,e),this.timers.clearInterval(this.timerId),this.timerId=this.timers.setTimeout(()=>u(this,null,function*(){Ui.log("Event quiet period ended, firing event",e),yield this.delegate(e)}),this.timeoutMs)})}};var Pa=b("events"),Pr=class{constructor(e,r,n=.2,i=new B){this.handle=e;this.running=r;this.idleThreshold=n;this.timers=i;this.lastState=!1;this.busy=!1;this.average=new Ee;this.idleHandler=e=>{let r=e.timeRemaining();this.running.value?this.busy=!1:r===0?this.busy=!0:(this.average=this.average.calculate(r),this.busy=this.average.percentage<-this.idleThreshold),this.busy?this.idleId=void 0:this.idleId=this.timers.requestIdleCallback(this.idleHandler,r===0?void 0:{timeout:r})};this.intervalHandler=()=>u(this,null,function*(){this.stateHasChanged()&&this.isIdle()&&(Pa.log("Browser idle"),yield this.handle("Idle")),this.average=new Ee,this.lastState=this.busy,this.idleId||(this.idleId=this.timers.requestIdleCallback(this.idleHandler))})}start(){return u(this,null,function*(){this.intervalId=this.timers.setInterval(this.intervalHandler,1e3),this.idleId=this.timers.requestIdleCallback(this.idleHandler)})}stop(){return u(this,null,function*(){this.intervalId&&this.timers.clearInterval(this.intervalId),this.idleId&&this.timers.cancelIdleCallback(this.idleId)})}isIdle(){return!this.busy}stateHasChanged(){return this.lastState!==this.busy}},Ee=class{constructor(e=0,r=0,n=0,i=0){this.value=e;this.count=r;this.difference=n;this.percentage=i}calculate(e){let r=this.count+1,n=e-this.value,i=n/this.value,s=this.value+n/r;return new Ee(s,r,n,i)}};var Ir=class{constructor(e,r){this.window=e;this.handle=r}start(){return u(this,null,function*(){this.window.addEventListener("visibilitychange",this.handle),this.window.addEventListener("popstate",this.handle),this.window.addEventListener("hashchange",this.handle),this.window.addEventListener("pageshow",this.handle),this.window.addEventListener("pagehide",this.handle),this.window.document.readyState!=="complete"?this.window.document.addEventListener("DOMContentLoaded",this.handle):yield this.handle("Document already loaded")})}stop(){return u(this,null,function*(){this.window.removeEventListener("visibilitychange",this.handle),this.window.removeEventListener("popstate",this.handle),this.window.removeEventListener("hashchange",this.handle),this.window.removeEventListener("pageshow",this.handle),this.window.removeEventListener("pagehide",this.handle),this.window.document.removeEventListener("DOMContentLoaded",this.handle)})}};var Rr=class{constructor(){this.value=!1}};var _i=class{constructor(e,r=new B){this.window=e;let n=new Rr;this.sink=new Ar(e,new Cr(new Tr,n)),this.fire=new Er(r,this.sink.fire).fire,this.mutation=new Pe(this.fire),this.created=new kr(r,this.fire),this.sources=[new Pr(this.fire,n),this.mutation,this.created,new Ir(e,this.fire)]}watch(e){this.created.watch(e)}listen(e){return u(this,null,function*(){yield this.sink.listen(e)})}start(){return u(this,null,function*(){yield Promise.all(this.sources.map(e=>e.start()))})}stop(){return u(this,null,function*(){this.sources.forEach(e=>e.stop())})}removeListener(e){this.sink.removeListener(e)}};function gt(t){let e=k(t).triptease;return e.events=e.events||new _i(t)}var Ia={characterData:!0,attributes:!0,childList:!0},Pe=class{constructor(e){this.handle=e;this.observer=new MutationObserver(this.handle)}start(){return u(this,null,function*(){})}stop(){return u(this,null,function*(){this.observer.disconnect()})}static observe(e,r=Ia){if(!("MutationObserver"in E))return e;let n=gt(E).mutation;return e instanceof HTMLInputElement||e instanceof HTMLSelectElement?e.addEventListener("change",n.handle):n.observer.observe(e,r),e}};function Lr(t,e=E){return p(()=>gt(e).watch(ji(e.document,t))),t}var Hr=class{constructor(e){this.parent=e}querySelector(e,r){let n=this.parent.querySelector(e);return n||void 0}querySelectorAll(e,r){return Array.from(this.parent.querySelectorAll(e))}},Mr=class{constructor(e){this.parent=e}querySelector(e,r){var i;Lr(e,(i=this.parent.ownerDocument)==null?void 0:i.defaultView);let n=this.parent.querySelector(e);return n?Pe.observe(n,r):void 0}querySelectorAll(e,r){var n;return Lr(e,(n=this.parent.ownerDocument)==null?void 0:n.defaultView),Array.from(this.parent.querySelectorAll(e)).map(i=>Pe.observe(i,r)).filter(Boolean)}};function yt(t){let e=st(t,"triptease-applications")||"auto";return p(()=>{let[r]=Te.find(new Hr(t.document)),{applications:n}=U(r.query);return n},e).toLowerCase()}var Ie;(function(h){h.Config="triptease.config",h.Event="triptease.event",h.Error="triptease.onboard.error",h.Message="triptease.onboard.message",h.PageDisplayedSearch="triptease.integration.page_displayed_search",h.PageDisplayedRoomsAndRates="triptease.integration.page_displayed_rooms-and-rates",h.PageDisplayedConfirmation="triptease.integration.page_displayed_confirmation",h.PageDisplayedCheckout="triptease.integration.page_displayed_checkout",h.PageDisplayedUnknown="triptease.integration.page_displayed_unknown",h.PageDisplayedGroup="triptease.integration.page_displayed_group",h.PageDisplayedPartial="triptease.integration.page_displayed_partial",h.PageErroredRoomsAndRates="triptease.integration.page_errored_rooms-and-rates",h.PageErroredConfirmation="triptease.integration.page_errored_confirmation",h.IntegrationData="triptease.integration.integration_data",h.PartialConfirmationPageData="triptease.integration.partial_confirmation_data",h.InvalidConfirmationData="triptease.integration.invalid_confirmation_data",h.InvalidPage="triptease.integration.invalid_page",h.GenericScript="triptease.integration.generic_script",h.DataCapture="triptease.integration.data_capture",h.GenericAnalysisConfirmation="triptease.integration.generic_analysis_confirmation",h.EntityUpdate="triptease.entity.update",h.StatusChanged="triptease.onboard.status-changed"})(Ie||(Ie={}));var Gi;(function(e){e.UserSubmittedPII="user_submitted_pii"})(Gi||(Gi={}));var Re=class{constructor(e,r,n){this.window=e;this.messageBatcher=r;this.messageBuilder=n}static create(e,r,n){var s;let i=k(e).onboard;return i.trackingApi=(s=i.trackingApi)!=null?s:new Re(e,r,n)}get isEnabled(){return yt(this.window)!=="none"}trackConfig(e){return u(this,null,function*(){!this.isEnabled||p(()=>e.payload.type===_.Payment)||(yield this.messageBatcher.send(y.removeEmpty(e)))})}trackEvent(e){return u(this,null,function*(){!this.isEnabled||(yield this.messageBatcher.send(e))})}trackError(e){return u(this,null,function*(){!this.isEnabled||(yield this.messageBatcher.send(yield this.messageBuilder.buildMessage({type:Ie.Error,errorType:xe(e)?"exception":"console",payload:e})))})}trackMessage(e){return u(this,null,function*(){!this.isEnabled||(yield this.messageBatcher.send(yield this.messageBuilder.buildMessage({type:Ie.Message,payload:e})))})}};var Le=class{constructor(e,r,n,i=re.create(e),s=b("integration-executor")){this.window=e;this.kernel=r;this.consent=n;this.starter=i;this.logger=s;s.debug("DefaultApplicationLoader constructor called")}loadApplications(e){return u(this,null,function*(){let r=yt(this.window);if(r==="none"||r==="tracking")return this.logger.log(`applications set to "${r}", skipping loading`),{};let{integrationId:n,clientKey:i,apiKey:s}=e,{applications:a}=yield this.kernel.applicationConfig({integrationId:n,clientKey:i,apiKey:s,includeDisabled:!0}),c=this.filterApplications(r,a);return(yield Promise.all(c.map(f=>u(this,null,function*(){let v=this.consent.for(f);try{if(ui(f)&&f.enabled&&v==="Granted")return yield this.starter.start(f),G(A({},f),{started:!0,consent:v})}catch(L){return G(A({},f),{started:!1,consent:v,error:L.message})}return G(A({},f),{consent:v})})))).reduce((f,v)=>(f[v.name]=y.removeEmpty({enabled:v.enabled,started:v.started,consent:v.consent,error:v.error}),f),{})})}filterApplications(e,r){return e==="auto"?r:r.filter(n=>n.name.toLowerCase()===e)}static create(e,r,n){var s;let i=k(e).triptease.onboard;return i.applicationLoader=(s=i.applicationLoader)!=null?s:new Le(e,r,n)}};var Dr=class{constructor(e,r=60*1e3,n=new B){this.handler=e;this.timeout=r;this.timers=n}handle(e){return u(this,null,function*(){let r=yield Promise.race([this.handler.handle(e),this.timers.delay(this.timeout)]);return r||{type:Ri,payload:new Error(`Request ${e.requestType} timed out after ${this.timeout}`),correlationId:e.correlationId}})}};var yo=R(pe());function ht(t){return t&&p(()=>t instanceof HTMLAnchorElement,t.tagName==="A")}var Fi=R(Q()),Wi=R($e());function Br(t){var e;return((e=t.host)==null?void 0:e.split("."))||[]}function bt(t,e){let r=Br(t).reverse(),n=Br(e).reverse(),i=0;for(let[s,a]of(0,Fi.array)(r,(0,Wi.zip)(n)))if(s===a)i++;else break;return i>=3?!0:i===2?[r[i],n[i]].filter(s=>![void 0,"www"].includes(s)).length<=1:!1}function Ki(t){let[e]=Br(t);return e}var Ra=new Set([void 0,o.Default]);function zi(t){return!Ra.has(wr(t))}function Vi(t,e){if(t.host===e.host)return!1;let r=bt(t,e);return!!(!r&&zi(e)||r&&La(e))}function La(t){let e=Ki(t);return e&&(e.includes("book")||e.includes("reservation"))}var Ha=new Set(["book now","book","book room","book your stay","booking","check rates","check availability","cancel reservation","my reservations","reservations","reserve agora"]);function Ni(t){return Ba(t).some(e=>Ha.has(e))}function Ma(t,e){let r=new S(e.href);return!!(Vi(t,r)||Ni(e))}function Da(t,e){let r=e.form;if(!r)return!1;let n=new S(e.formAction||e.getAttribute("formaction")||r.action);return!!(Vi(t,n)||Ni(e))}function $i(t,e){return zi(t)?!1:ht(e)?Ma(t,e):Da(t,e)}function Ba(t){return[t.innerText||t.textContent,t.value,t.title,t.getAttribute("alt")].filter(Boolean).map(e=>e.trim().toLowerCase())}function Ji(t){var e,r,n;return y.removeEmpty({element:t.tagName.toLowerCase(),classes:Array.from(t.classList),id:t.id,target:t.target.trim(),url:t.href.trim(),urlParsed:Ae(t.href),text:(r=(e=t.innerText)!=null?e:t.textContent)==null?void 0:r.trim(),title:t.title.trim(),alt:(n=t.getAttribute("alt"))==null?void 0:n.trim(),rel:Array.from(t.relList)})}var ja=b("click-tracking"),jr=class{constructor(e,r){this.window=e;this.bootstrap=r;this.clickHandler=e=>u(this,null,function*(){try{let r=e.target;if(ht(r)){let n=new S(this.window.location.href),i=new S(r.href);if(i.scheme==="javascript"||i.scheme==="about")return;i.scheme==="tel"?yield this.fireClickEvent("user_clicked_phone-number",r):i.scheme==="mailto"?yield this.fireClickEvent("user_clicked_email-address",r):$i(n,r)?yield this.fireClickEvent("user_clicked_booking-engine-link",r):r.href&&!bt(n,i)&&(yield this.fireClickEvent("user_clicked_outbound-link",r))}}catch(r){ja.error("clickHandler: Error ",r)}})}start(){this.window.addEventListener("click",this.clickHandler,{capture:!0,passive:!0})}stop(){this.window.removeEventListener("click",this.clickHandler)}fireClickEvent(e,r){return u(this,null,function*(){let n=k(this.window).triptease.config;yield this.bootstrap.processEvent(y.removeEmpty({type:"triptease.event",event:e,payload:{integrationId:p(()=>n.integrationId),clientKey:p(()=>n.clientKey),clientName:p(()=>n.clientName),apiKey:p(()=>n.apiKey),hotelName:p(()=>n.hotelName),click:Ji(r)}}))})}};var qr=class{static parse(e){if(!!e)return qr.lookup.get(e.toLowerCase().trim())}},vt=qr;vt.lookup=["none","essential","functionality","performance","marketing","all"].reduce((e,r)=>e.set(r,r),new Map);var Ur=class{constructor(e){this.window=e}find(){return Te.scripts(new Mr(this.window.document)).map(r=>r.dataset.storageConsent).filter(Boolean).flatMap(r=>r.split(/\s*,\s*/g).map(n=>vt.parse(n))).filter(Boolean)}};var _r=R(Q());var Yi=b("consent"),Zi=new Set(["all"]);function qa(t){let e=new Set(t.filter(Boolean));return e.size===0||e.has("all")?Zi:(e.has("none")&&e.size!==1&&e.delete("none"),e)}var He=class{constructor(e){this.callbacks=new Set;this.set(e)}onChange(e){this.callbacks.add(e)}set(e){Yi.debug("Setting user consent");let r=this.values;this.values=qa(e),(!r||!O.same(Array.from(r).sort(_r.ascending),Array.from(this.values).sort(_r.ascending)))&&this.fireChanged()}fireChanged(){this.callbacks.forEach(e=>{try{e()}catch(r){Yi.error(r)}})}toArray(){return Array.from(this.values)}get applications(){let e=this.values.has("functionality"),r=this.values.has("performance"),n=this.values.has("marketing"),i=this.values.has("all");return new Map([["Chat",e||i?"Granted":"Denied"],["CrossOriginTracking","Granted"],["GoogleAnalyticsPrototype",r||n||i?"Granted":"Denied"],["Messages",e||n||i?"Granted":"Denied"],["Meta",r||n||i?"Granted":"Denied"],["PaidSearch",r||n||i?"Granted":"Denied"],["Parity",e||r||n||i?"Granted":"Denied"],["Retargeting",n||i?"Granted":"Denied"]])}for(e){return this.values.has("all")?"Granted":this.applications.get(e.name)||(e.type==="other"?"Granted":"Denied")}get firstPartyStorage(){return!(this.values.has("none")||this.values.has("essential"))}get thirdPartyStorage(){return!(this.values.has("none")||this.values.has("essential"))}static create(e){var i,s;let r=new Ur(e),n=new He(r.find());return(s=(i=k(e).triptease)==null?void 0:i.events)==null||s.listen(()=>u(this,null,function*(){return n.set(r.find())})),n}get cmp(){return[]}get script(){return this.overall}get overall(){return Array.from(this.values)}};var eo=R(xt());var to=R(pe()),wt=class{constructor(e,r=new eo.SystemClock,n=fe({credentials:!0})){this.window=e;this.clock=r;this.httpClient=n}getIdentityClientData(){return u(this,null,function*(){let e=yield this.httpClient({url:"https://onboard.triptease.io/identity",method:"GET"});if(e.status!==200)return{};let r=D.parseWithDates(e.body),n=p(()=>{let i=r.serverTime;return this.clock.now().getTime()-i.getTime()});return G(A({},r),{timeOffset:n})})}};C([to.cache],wt.prototype,"getIdentityClientData",1);var ro=R(xt());var Me=class{generate(e){return io(e)()}};function Gr(t){let e=new Error(t);return e.source="ulid",e}var Fr="0123456789ABCDEFGHJKMNPQRSTVWXYZ",De=Fr.length,no=Math.pow(2,48)-1,St=10;function Ua(t){let e=Math.floor(t()*De);return e===De&&(e=De-1),Fr.charAt(e)}function _a(t,e){if(isNaN(t))throw new Error(t+" must be a number");if(t>no)throw Gr("cannot encode time greater than "+no);if(t<0)throw Gr("time must be positive");if(!Number.isInteger(t))throw Gr("time must be an integer");let r,n="";for(;e>0;e--)r=t%De,n=Fr.charAt(r)+n,t=(t-r)/De;return n}function Ga(t,e){let r="";for(;t>0;t--)r=Ua(e)+r;return r}var Fa=E;function Wa(t=Fa.crypto){return()=>{try{let e=new Uint8Array(1);return t.getRandomValues(e),e[0]/255}catch(e){return Math.random()}}}function Ka(t){if(t<St)throw new Error(`Length must be at least ${St} characters`);return t-St}function io(t=26,e=new ro.SystemClock,r=Wa()){return function(i){return(i===void 0||isNaN(i))&&(i=e.now().getTime()),_a(i,St)+Ga(Ka(t),r)}}var uf=io();var At=class{constructor(e,r=new Me){this.window=e;this.idGenerator=r}getDomainUserId(){try{let r=this.window.localStorage.getItem(At.KEY);if(r)return{domainUserId:r}}catch(r){}let e=this.idGenerator.generate();try{this.window.localStorage.setItem(At.KEY,e)}catch(r){}return{domainUserId:e}}},kt=At;kt.KEY="tt-domain-user-id";var Be=class{constructor(e){this.providers=e}static create(...e){return new Be(e)}getAnonymousIds(){return u(this,null,function*(){return T.unique(T.flatten(yield Promise.all(this.providers.map(e=>p(()=>e.getAnonymousIds(),[])))))})}setAnonymousId(e){return u(this,null,function*(){yield Promise.all(this.providers.map(r=>p(()=>r.setAnonymousId(e))))})}};var Wr=class{constructor(e,r=new Me){this.delegate=e;this.generator=r}getAnonymousIds(){return u(this,null,function*(){let r=(yield this.delegate.getAnonymousIds()).sort()[0]||this.generator.generate();return yield this.delegate.setAnonymousId(r),[r]})}setAnonymousId(e){return this.delegate.setAnonymousId(e)}};var Kr="triptease-anonymous-id",Ot=class{constructor(e){this.storage=e}getAnonymousIds(){return u(this,null,function*(){let e=this.storage.get(Kr);return e?[e]:[]})}setAnonymousId(e){return u(this,null,function*(){let r=this.storage.get(Kr);(r&&e<r||!r)&&this.storage.set(Kr,e)})}};var je=class{constructor(e){this.storage=e}get(e){let r=this.storage.getItem(e);if(r)return D.parseWithDates(r)}set(e,r){return this.storage.setItem(e,JSON.stringify(r)),this}clear(){this.storage.clear()}},qe=class{constructor(){this.data=new Map}get(e){return this.data.get(e)}set(e,r){return this.data.set(e,r)}clear(){this.data.clear()}},zr=class{constructor(e){this.stores=e}clear(){this.stores.forEach(e=>p(()=>e.clear()))}get(e){for(let r of this.stores){let n=p(()=>r.get(e));if(n)return n}}set(e,r){return this.stores.forEach(n=>p(()=>n.set(e,r))),this}};var Ue=R(be()),oo=R(pe()),so=R(xt()),Vr=class{static add(e,r){let n=new Date(e.getTime());return n.setUTCDate(e.getUTCDate()+r),n}};Vr.milliseconds=24*60*60*1e3;function*za(t,e){for(;t>=e;)yield t%e,t=Math.floor(t/e);yield t}function Nr(t,e){return Array.from(t).reduce((r,n,i)=>r+rn(e,i)*n,0)}function*Va(t,e){for(let r of $a(t,e))yield Nr(r,2)}function*Na(t,e){for(let r of t)for(let n=0;n<e;n++)yield ao(r,n)}function*$a(t,e){let r=[];for(let n of t)r.push(n),r.length===e&&(yield r,r=[]);r.length>0&&(yield r)}function*Ja(t){let e=t.BYTES_PER_ELEMENT*8;for(let r of t)for(let n=0;n<e;n++)yield ao(r,n)}function ao(t,e){return t&1<<e?1:0}var ye=class{constructor(e){this.digits=e}get base(){return this.digits.length}get bitsPerCharacter(){return Math.log(this.base)/Math.log(2)}encodeInteger(e){return this.encode(za(e,this.base))}encodeBits(e){return this.encode(Va(e,this.bitsPerCharacter))}encode(e){return Array.from(e).map(r=>this.digits[r]).join("")}get lookup(){return[...this.digits].reduce((e,r,n)=>e.set(r,n),new Map)}decodeInteger(e){return Nr(this.decode(e),this.base)}decodeBits(e){return Na(this.decode(e),this.bitsPerCharacter)}decode(e){return[...e].map(r=>this.lookup.get(r))}};C([Ue.lazy],ye.prototype,"base",1),C([Ue.lazy],ye.prototype,"bitsPerCharacter",1),C([Ue.lazy],ye.prototype,"lookup",1);var oe=new ye("0123456789ABCDEFGHJKMNPQRSTVWXYZ"),Ya=new ye("0123456789ABCDEF"),co=class{static get detect(){try{let e=new ArrayBuffer(2);return new DataView(e).setInt16(0,256,!0),new Int16Array(e)[0]===256?"LittleEndian":"BigEndian"}catch(e){return"Unknown"}}};C([Ue.lazy],co,"detect",1);var W=class{constructor(e,r){this.timestamp=e;this.entropy=r;if(r.length%oe.bitsPerCharacter!=0)throw Error(`entropy bit length must be a multiple of ${oe.bitsPerCharacter}`)}toString(){let e=Ct(oe.encodeInteger(this.timestamp.getTime())).padStart(W.TIMESTAMP_LENGTH,"0"),r=Ct(oe.encodeBits(this.entropy));return e+r}static parse(e){let r=e.slice(0,W.TIMESTAMP_LENGTH),n=e.slice(W.TIMESTAMP_LENGTH),i=oe.decodeInteger(Ct(r)),s=oe.decodeBits(Ct(n));return new W(new Date(i),Array.from(s))}static create(e=W.DEFAULT_LENGTH,r=lo,n=new so.SystemClock){if(e<W.TIMESTAMP_LENGTH)throw new Error(`Length must be greater than ${W.TIMESTAMP_LENGTH}`);let i=(e-W.TIMESTAMP_LENGTH)*oe.bitsPerCharacter;return new W(n.now(),Za(i,r))}static fromUUID(e,r,n=Vr.add(r,1)){let i=e.toUpperCase().replace(/-/g,""),s=Array.from(Ya.decodeBits(i)).reverse(),a=n.getTime()-r.getTime(),c=Math.ceil(Math.log(a)/Math.log(2)),d=Nr(s.slice(80,80+c),2)%a,f=s.slice(0,80);return new W(new Date(r.getTime()+d),f)}toJSON(){return this.toString()}},se=W;se.DEFAULT_LENGTH=26,se.TIMESTAMP_LENGTH=10,C([oo.cache],se.prototype,"toString",1);function Ct(t){return[...t].reverse().join("")}function lo(t){try{return crypto.getRandomValues(t)}catch(e){return on("crypto").webcrypto.getRandomValues(t)}}function Za(t,e=lo){return Array.from(Ja(e(new Uint8Array(Math.ceil(t/8))))).slice(0,t)}var Qa=new Date(Date.UTC(2020,12-1,16)),$r=class{constructor(e){this.storage=e;this.key="tt-domain-user-id";this.pattern=/[0-9A-Fa-f\-]/}getAnonymousIds(){return u(this,null,function*(){let e=this.storage[this.key];return e?e.match(this.pattern)&&e.length!==se.DEFAULT_LENGTH?[se.fromUUID(e,Qa).toString()]:[e]:[]})}setAnonymousId(e){return u(this,null,function*(){})}};var Tt=b("identity"),_e=class{constructor(e,r,n=new B){this.delay=e;this.delegate=r;this.timers=n;this.raceCounter=0}getAnonymousIds(){let e=this.raceCounter++;return Promise.race([(()=>u(this,null,function*(){Tt.debug("TimeoutIdentityProvider delegate.getAnonymousIds called",e);let r=yield this.delegate.getAnonymousIds();return Tt.debug("TimeoutIdentityProvider delegate.getAnonymousIds returned",r,e),r}))(),this.wait(e)])}setAnonymousId(e){return u(this,null,function*(){Tt.debug("TimeoutIdentityProvider delegate.setAnonymousId called",e),this.delegate.setAnonymousId(e)})}wait(e){return u(this,null,function*(){return yield this.timers.delay(this.delay),Tt.debug(`TimeoutIdentityProvider waited for ${this.delay} ms`,e),[]})}};var Jr=class{getAnonymousIds(){return u(this,null,function*(){return[]})}setAnonymousId(e){return u(this,null,function*(){})}};function uo(t){return t.opener?new _e(800,ne(new me(new N(t,t.opener,[])))):new Jr}var po=b("identity"),Yr=class{constructor(e,r,n,i=new wt(e),s=new kt(e),a=new qe){this.window=e;this.kernelHost=r;this.consent=n;this.identityClient=i;this.domainUserId=s;this.inMemoryStorage=a;this.build=()=>{po.debug("Building identity providers");let e=[new Ot(this.inMemoryStorage),uo(this.window)];this.consent.firstPartyStorage&&(e.push(p(()=>new Ot(new je(this.window.localStorage)))),e.push(new $r(p(()=>this.window.localStorage,{})))),this.consent.thirdPartyStorage&&e.push(new _e(100,this.kernelHost)),this.identityProvider=new Wr(Be.create(...e))};this.consent.onChange(this.build),this.build()}getIdentity(){return u(this,null,function*(){return po.debug("getIdentity called"),y.removeEmpty((yield Promise.all([this.consent.thirdPartyStorage?ee(()=>this.identityClient.getIdentityClientData(),{}):Promise.resolve({}),ee(()=>u(this,null,function*(){return{anonymousId:T.first(yield this.identityProvider.getAnonymousIds())}}),{}),this.consent.firstPartyStorage?p(()=>this.domainUserId.getDomainUserId(),{}):{}])).reduce((e,r)=>A(A({},e),r),{}))})}getAnonymousIds(){return this.identityProvider.getAnonymousIds()}setAnonymousId(e){return this.identityProvider.setAnonymousId(e)}};var Xa=b("bootstrap"),Zr=class{constructor(e=di(1e3*6,fe({credentials:!0}))){this.fetch=e}lookupClaim(e){return u(this,null,function*(){try{let{apiKey:r,claimKey:n}=e,i=new URL("https://onboard.triptease.io/claim");r&&i.searchParams.append("apiKey",r),n&&i.searchParams.append("claimKey",n);let s=yield this.fetch({method:"GET",url:i.toString()});if(s&&s.status===200)return JSON.parse(s.body)}catch(r){Xa.debug("call to redirect /claim failed",r)}return{}})}};var fo=["page","referrer","redirectSource","redirectDestination"];function mo(t){if(!t)return;let e=t instanceof Date?t:new Date(t);return isNaN(e.getTime())?void 0:e}function go(t,e){if(typeof e!="object")return t;let{url:r,urlSource:n,timestamp:i}=e!=null?e:{};return typeof r=="string"&&r.length!==0&&fo.includes(n)&&t.push(y.removeEmpty({url:r,urlSource:n,timestamp:mo(i)})),t}var ae=class{constructor(e){this.storage=e}static create(e){let r=new zr([p(()=>new je(e.sessionStorage)),ae.backupStorage]),n=new ae(r);return n.exists()&&(n.data=n.data),n}append(e){let r=this.data;return r.push(e),this.data=r,e}prepend(e){let r=this.data;return r.unshift(e),this.data=r,e}set data(e){this.storage.set(ae.storageKey,$n(e.reduce(go,[]),10))}get data(){let e=this.storage.get(ae.storageKey);return(Array.isArray(e)?e:[]).reduce(go,[])}exists(){return!!this.storage.get(ae.storageKey)}clear(){this.storage.clear()}},Ge=ae;Ge.storageKey="triptease.integration.previous-urls",Ge.backupStorage=new qe;var Qr=class{constructor(e,r=new Zr,n=Ge.create(e)){this.window=e;this.claimService=r;this.urlHistory=n}urls(e,r){return u(this,null,function*(){if(!this.hasClaim()){this.urlHistory.append({url:this.window.document.referrer,urlSource:"referrer",timestamp:r}),this.urlHistory.append({url:this.window.location.href,urlSource:"page",timestamp:r});let{tt_claim_key:n}=U(this.window.location.search);if(n||e){let{redirectSource:i,redirectDestination:s,timestamp:a}=yield this.claimService.lookupClaim({apiKey:e,claimKey:n}),c=p(()=>new Date(a));this.urlHistory.prepend({url:s,urlSource:"redirectDestination",timestamp:c}),this.urlHistory.prepend({url:i,urlSource:"redirectSource",timestamp:c})}}return this.urlHistory.data})}hasClaim(){return this.urlHistory.exists()}};var Et=class{constructor(e,r=new dr,n=gt(e),i=He.create(e),s=new gr(e,r),a=re.create(e),c=ke.create(e)){this.window=e;this.clock=r;this.events=n;this.consent=i;this.messageBatcher=s;this.starter=a;this.stackScripts=c;this.integrate=()=>u(this,null,function*(){try{this.logger.log("Starting integrate()");let e=Mi(this.window);k(this.window).onboard.integrationName=e;let r=ec(e);yield this.starter.start(r)}catch(e){this.logger.error("Bootstrap.integrate: unhandled exception",e)}});k(this.window).onboard.bootstrap=this,this.clickTracking=new jr(this.window,this)}get logger(){return this.trackingApi?new or("bootstrap",this.trackingApi):b("bootstrap")}start(){return u(this,null,function*(){try{this.logger.debug("Bootstrap starting"),H.exposeApi(),this.stackScripts.capture();let r=(yield this.kernelFrame()).contentWindow;if(!r){this.logger.log("Kernel frame did not generate a content window, aborting");return}let n=new N(this.window,r,[]),i=new Dr(new me(n));this.kernel=new mr(i),this.kernelHost=ne(i),this.identityCombiner=new Yr(this.window,this.kernelHost,this.consent),k(this.window).onboard.messageBuilder=this.messageBuilder=new yr(new dt(this.window),new Qr(this.window),this.identityCombiner),this.trackingApi=Re.create(this.window,this.messageBatcher,this.messageBuilder),new Sr(n,new br().register(["processEvent","processConfig","processNavigation"],new Oe(this)).register(["getAnonymousIds","setAnonymousId"],new Oe(this.identityCombiner)).register(["trackConfig","trackEvent","trackError","trackMessage"],new Oe(this.trackingApi))).registerAlias("triptease.event","processEvent").registerAlias("triptease.navigation","processNavigation").registerAlias("triptease.config","trackConfig"),this.applicationLoader=Le.create(this.window,this.kernel,this.consent),this.clickTracking.start(),yield this.events.listen(this.integrate),yield this.events.start()}catch(e){this.logger.error("Bootstrap.start: unhandled exception",e)}})}reload(){return u(this,null,function*(){yield this.start(),this.logger.debug("Bootstrap reloading"),this.stackScripts.capture(),yield this.integrate()})}kernelFrame(){return u(this,null,function*(){let e=lr.application(this.window.location.hostname);return yield this.starter.start(e)})}processEvent(e){return u(this,null,function*(){let r=yield this.kernelHost.getPageState(),n=yield this.messageBuilder.buildMessage(O.merge(e,r));yield ne(new me(new N(void 0,window,[]))).trackEvent(n)})}processConfig(e){return u(this,null,function*(){let r=yield this.applicationLoader.loadApplications(e.payload);k(this.window).triptease.config=e.payload;let n=G(A({},e),{applications:r});k(this.window).triptease.message=n,this.logger.log("Broadcasting triptease.config message",e.payload),new N(void 0,this.window).send(n)})}processNavigation(e){return u(this,null,function*(){let r=this.window.document.createElement("a");r.style.display="none",r.classList.add("triptease-navigation");for(let[n,i]of Object.entries(e))r[n]=i;this.window.document.documentElement.appendChild(r),r.click(),this.window.document.documentElement.removeChild(r)})}};C([yo.cache],Et.prototype,"start",1);function ec(t){return{name:t.name,url:t.script,type:"script",enabled:!0}}var ho=b("bootstrap"),bo=p(()=>window.triptease.onboard.bootstrap);(()=>u(void 0,null,function*(){let{"triptease-bootstrap-version":t=""}=U(window.location.search);["none","noop"].includes(t.toLowerCase())||(bo?(ho.log("Bootstrap reloading"),yield bo.reload()):(ho.log("Creating new bootstrap"),yield new Et(window).start()))}))();})();
